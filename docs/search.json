[{"path":"index.html","id":"introduction","chapter":"Introduction","heading":"Introduction","text":"Determining positions, time trajectories, wildlife crucial apprehend ecological relationships nature. Since satellite devices (e.g. GPS) heavy bird species, lightweight geolocators remain essential tool track bird movement.Geolocation pressure provides exciting opportunity determine position birds high precision using small tracking devices.Indeed, atmospheric pressure varies space time, timeseries pressure measurement recorded single location constitutes unique signature can used global positioning.GeoPressure suite helps users tackle challenges geolocation pressure provides toolkit implement two methods published following two papers:Nussbaumer et al. (2023a) presents method estimate map likely positions pressure timeseries,Nussbaumer et al. (2023b) describes new approach reconstruct full trajectory bird quickly accurately, using pressure wind data.quick overview method, 10 min presentation:","code":""},{"path":"index.html","id":"data-requirements","chapter":"Introduction","heading":"0.1 Data requirements","text":"strict requirement geolocator provides continuous timeseries pressure (<1hr resolution). Beyond , things can help:GeoPressureR works best species clear separation stationary migratory periods, opposed birds moving continuously time /gradually large distances (10-50km) altitude (>10m). , aerial feeders swifts bee-eaters mountainous species lend well method.Acceleration data can helpful define periods flight, especially bird flies low altitude pressure data measured coarse temporal resolution (>15min).Light data can accelerate building trajectory model allowing quickly narrow possible locations short stationary periods. Generally, species long stopover, light data brings limited benefit, can quite helpful species multiple short stopovers, particularly migrating east/west trajectory.Knowing equipment retrieval sites can also helpful, also works well without .GeoPressureR can currently read Swiss Ornithological Institute (SOI) files (*.pressure, *.lux, *.acceleration), Migrate Technology files (\"*.deg\" \"*.lux\") Lund CAnMove (\"*.xlsx\").Feel free contact discuss data study species.","code":""},{"path":"index.html","id":"the-geopressure-suite","chapter":"Introduction","heading":"0.2 The GeoPressure suite","text":"GeoPressure suite includes several tools:GeoPressureR main R package functions run analysis.GeoPressureManual official user guide developed help learn use GeoPressureR.GeoPressureTemplate template Github repository help kickstart project.GeoPressureAPI JSON API used GeoPressureR hood query ERA5 reanalysis data Google Earth Engine.GeoPressureViz shiny app included GeoPressureR visualize trajectory bird. See GeoPressureViz chapter introduction demo 18LX.","code":""},{"path":"index.html","id":"structure-of-the-manual","chapter":"Introduction","heading":"0.3 Structure of the manual","text":"manual provides easy entry point pressure positioning. includes three parts:basic tutorial runs entire workflow using simple track pressure , example Swainson’s Warbler.advanced tutorial explores additional functionalities package using light, acceleration, wind data, example Great Reed Warbler.Labelling tools introduces labelling, critical step workflow. complex procedure requiring comprehensive understanding method tools package, described depth basic advanced tutorials. strongly recommended reading section attentively optimal results.Feel free read manual, fork repository run examples pace.","code":""},{"path":"index.html","id":"code-structure","chapter":"Introduction","heading":"0.4 Code structure","text":"GeoPressureTemplate defines standard folder structure improve readability, sharability, reproducibility. structure follows standard recommendation separating data analysis (see Cookiecutter Data Science , rrrpkg rrtools rationale behind ). manual follows standard directory file name.","code":""},{"path":"index.html","id":"installation","chapter":"Introduction","heading":"0.5 Installation","text":"best way install GeoPressureR package Github:can load pacakge along others need later:","code":"\ninstall.packages(\"devtools\")\ndevtools::install_github(\"Rafnuss/GeoPressureR\")\nlibrary(GeoPressureR)\nlibrary(ggplot2)\nlibrary(plotly)\nlibrary(knitr)"},{"path":"tag-object.html","id":"tag-object","chapter":"1 Tag object","heading":"1 Tag object","text":"basic tutorial, go main steps GeoPressureR using pressure data, example Swainson’s Warbler. bird presents short migration route, stopovers, making easy process fast compute.","code":""},{"path":"tag-object.html","id":"create-tag","chapter":"1 Tag object","heading":"1.1 Create tag","text":"tag specific geolocator datalogger can contain multiple sensors (e.g., pressure, light, acceleration). archival tag usually re-equipped, consider associated single deployment.GeoPressureR, tag object (.e., S3 class) created raw logger data. modified step workflow aggregates information needed ultimately able model bird’s trajectory.tag object created based available data stored \"./data/raw-tag/CB619/\" following default structure described GeoPressureTemplate.can use generic print() plot() function visualize tag data.Depending equipped bird tag started recording data, likely need crop data specific dates. bad practice modify raw data, recommend using crop_start crop_end arguments tag_create().","code":"\ntag <- tag_create(id = \"CB619\")## ✔ Read './data/raw-tag/CB619/CB619.deg'\n## \n## ✔ Read './data/raw-tag/CB619/CB619.deg'## Warning: ! No file is matching '*.lux'.\n## → This sensor will be ignored.\nplot(tag, type = \"pressure\")"},{"path":"tag-object.html","id":"label-tag-into-stationary-periods","chapter":"1 Tag object","heading":"1.2 Label tag into stationary periods","text":"Labelling tracks involves two steps:Label periods flight, , extension define STAtionary Periods (called stap code), bird assumed remain location (+/- tens kilometers) elevation level (+/- meters)Discard pressure measurements used estimate position (due , example, sensor error, flight, minor/short changes elevation level, etc.)Correctly labelling track requires time effort, key accurately estimate bird’s position.labelling relies functions tools presented later tutorial, recommend first following basic advanced tutorials. , strongly advise read attentively recommendations step provided labelling tracks.","code":""},{"path":"tag-object.html","id":"initialize-and-create-the-label-.csv-file","chapter":"1 Tag object","heading":"1.2.1 Initialize and create the label .csv file","text":"Use tag_label_write() initiate label (.e., empty label) create label file \"./data/tag-label/CB619.csv\".","code":"\ntag_label_write(tag)## ℹ No label data.\n## → Initialize automatically label using `tag_label_auto()`## ✔ './data/tag-label/CB619.csv' written successfully."},{"path":"tag-object.html","id":"label-manually-on-trainset","chapter":"1 Tag object","heading":"1.2.2 Label manually on Trainset","text":"Open https://trainset.raphaelnussbaumer.com/ click “Upload Tag Label” load .csv file. Instructions label file can found dedicated chapter labelling tracks. finished, export new csv file folder /data/tag-label/CB619-labeled.csv (TRAINSET automatically add -labeled name).","code":""},{"path":"tag-object.html","id":"read-labelled-file","chapter":"1 Tag object","heading":"1.2.3 Read labelled file","text":"Read exported file tag_label_read() update tag$pressure (, relevant, tag$acceleration), new label column.","code":"\ntag <- tag_label_read(tag)\nkable(head(tag$pressure))"},{"path":"tag-object.html","id":"compute-stationary-periods","chapter":"1 Tag object","heading":"1.2.4 Compute stationary periods","text":"tag_label_stap() creates stationary periods based labels:Plotting pressure timeseries tag provides additional information:might notice discrepancies raw data (grey) pre-processed pressure timeseries stationary period (colored lines).pre-processing aligns raw timeseries data weather reanalysis pressure data removing outliers downscaling resolution 1hr falling exact hour.black dots show discarded pressure points (.e., outliers), corresponding bird vertical movement rather natural variation pressure.function tag_label() wrapper tag_label_write(), tag_label_read() tag_label_stap(), allowing process label file (.e., CB619-labeled.csv) single line.","code":"\ntag <- tag_label_stap(tag, quiet = TRUE)\nkable(head(tag$stap))\nplot(tag, type = \"pressure\", quiet = TRUE)"},{"path":"pressure-map.html","id":"pressure-map","chapter":"2 Pressure map","heading":"2 Pressure map","text":"second chapter basic tutorial covers main steps determine position bird pressure data. code direct implementation method introduced Nussbaumer et al. (2023a).GeoPressureR, map object container spatio-temporal variable, likelihood pressure. therefore defined spatial characteristics (extent scale) temporal dimension terms stationary periods. data stored list matrices: one matrix (layer) stationary period.See map_create() technical characteristics GeoPressureR map.","code":""},{"path":"pressure-map.html","id":"define-geographical-and-temporal-parameters-of-the-map","chapter":"2 Pressure map","heading":"2.1 Define geographical and temporal parameters of the map","text":"first step define characteristics map, setting following parameter tag object.Read meaning parameters documentation function tag_set_map(). additional indications select optimal parameters:smaller map (small scale tight extent) results faster computation. However, extent small excludes true position bird, process still produce trajectory, wrong trajectory. recommend starting coarse scale = 1 2 large extent refining better idea trajectory completed labeling.Using known position can significantly speeds computation excludes stationary periods long timeseries computation.Depending precision trajectory need study, include_min_duration can great help reduce complexity labeling computation.","code":"\ntag <- tag_set_map(tag,\n  extent = c(-100, -68, 0, 40), # coordinates of the map to request (W, E, S, N)\n  scale = 2, # request on a 1/2=0.5° grid, coarse, but fast\n  known = data.frame(\n    stap_id = 1,\n    known_lat = 37.286812,\n    known_lon = -82.304972\n  )\n)"},{"path":"pressure-map.html","id":"compute-pressure-maps","chapter":"2 Pressure map","heading":"2.2 Compute pressure maps","text":"now ready create pressure maps!, must match pressure timeseries stationary period surface level pressure dataset ERA5-Land hourly possible pixels maps.overcome challenges handling large ERA5 dataset, perform mismatch computation Google Earth Engine (GEE) server access ERA5 dataset directly returns map mismatch.GeoPressureR uses GeoPressureAPI serves interface GEE server.function geopressure_map() conveniently performs necessary steps, outline step comprehensive understanding.","code":""},{"path":"pressure-map.html","id":"compute-mismatch-maps","chapter":"2 Pressure map","heading":"2.2.1 Compute mismatch maps","text":"max_sample reduces computational time limiting number data-points used match. impacts long stationary periods position well defined. labelling, accuracy critical, can convenient reduce number 50 100.margin can reduced 10 20 bird change elevation level stationary period.thr_mask filter map based absolute pressure threashold already GEE server drastically reduce computational time (see details). generally little influence can usually left 0.9.function computationally intensive needs :Pre-process pressure: pressure measurements first smoothed downscaled 1-hour resolution order match ERA-5 resolution (see geopressure_map_preprocess()).Generate requests: Send single request GeoPressureAPI generate Google Earth Engine (GEE) URLs, one stationary period can used compute maps GEE server. stage, computation performed, just generated actual code.Send requests: Call URLs parallel, start computation GEE server.Compute download maps: requests sent, wait GEE server return geotiff file (map) stationary period.progress bar update completion status, timing can tricky apprehend computational optimization used variability GEE server availability.function returns tag two maps:\n- tag$map_pressure_mask \\(\\textbf{z}_{thr}\\) GeoPressureR map proportion data-points pressure timeseries correspond altitude falls min max altitude grid cell (accounting margin parameter).\n- tag$map_pressure_mse \\(\\textbf{MSE}\\) GeoPressureR map normalized mean square error tag pressure timeseries ERA5 map. mean error removed assume specific altitude tag, thus allowing altitudinal shift pressure timeseries. computational efficiency, \\(\\textbf{MSE}\\) computed pixels \\(\\textbf{z}_{thr}>thr_{mask}\\).alternative identical way plot map tag.","code":"\ntag <- geopressure_map_mismatch(tag,\n  max_sample = 100,\n  margin = 20,\n  thr_mask = 0.95,\n  quiet = TRUE\n)\nplot(tag, type = \"map_pressure_mse\")\nplot(tag$map_pressure_mask)"},{"path":"pressure-map.html","id":"compute-likelihood-maps","chapter":"2 Pressure map","heading":"2.2.2 Compute likelihood maps","text":"combine convert two maps single likelihood map using \\[f \\propto \\exp \\left(-w(n) \\frac{\\textbf{MSE}}{\\sigma^2} \\right) [\\textbf{z}_{thr}>thr_{mask}]\\] \\(\\sigma\\) standard deviation pressure error \\(thr_{mask}\\) threshold mask.auto-correlation timeseries accounted equation, use log-linear pooling weight \\(w(n)=\\log(n)/n\\), \\(n\\) number data-points time series. See Probability aggregation information .standard deviation sd (\\(\\sigma\\)) plays important role spread uncertainty map. accounts (1) error reanalysis data (may vary spatially, generally assumed small), (2) sensor error (also assumed low), (3) bird vertical movement (significant contribution). bird moving tall tree (1 hPa = 10 m) likely affect match.value ideally calibrated, usually safe start value 1. see adjust value check #4 labelling procedure. Swainson’s Warbler tend stay low small pressure variation value 0.5 adequate. addition, following several trial error test, found scaling log linear pooling function 4 * log(n) / n provides satifying result.resulting pressure likelihood map can visualized :Note threshold mask performed directly GEE server, .e., geopressure_map_mismatch(). allows compute MSE pixels within threshold, thus reducing computational cost significantly.geopressure_map() function wrapper geopressure_map_mismatch() geopressure_map_likelihood(). default, delete mask MSE map save space (see keep_mask keep_mse parameters).","code":"\ntag <- geopressure_map_likelihood(\n  tag,\n  sd = 0.5,\n  log_linear_pooling_weight = \\(n) 4 * log(n) / n\n)\nplot(tag$map_pressure)"},{"path":"trajectory.html","id":"trajectory","chapter":"3 Trajectory","heading":"3 Trajectory","text":"last chapter basic tutorial, model full trajectory Swainson’s Warbler combining observation model pressure movement model flight accounting likely speed constrain possible distances stationary periods. , use highly optimized Hidden Markov model presented Nussbaumer et al. (2023b).involves three main steps:Create graph representing possible trajectory bird.Set movement model defines likelihood possible flight encoded graph.Compute three products model: (1) likely trajectory, (2) probability maps stationary period (.e., marginals), (3) simulated paths sampled according likelihood.","code":""},{"path":"trajectory.html","id":"background-on-movement-modeling","chapter":"3 Trajectory","heading":"3.1 Background on movement modeling","text":"haven’t heard Hidden Markov model, state-space models, trellis graphs, recommend start reading summary , - even better - read Patterson et al. (2008) Nussbaumer et al. (2023b) ’re feeling brave!start making fundamental assumption overall trajectory can separated discrete positions , together, create trajectory.discretization allows us use Hidden Markov model, conveniently distinguishes unknown positions bird \\(X_t\\) known observations \\(Y_t\\) can related positions (e.g., pressure light measurement). Defining HMM requires set:observation model \\(P(Y_t | X_t)\\), defines likelihood observing measurement given position. exactly pressure likelihood map computed previous chapter .movement model \\(P(X_t+1|X_t)\\), defining probability bird able fly specific distance two consecutive stationary periods.initial state \\(P(X_0)\\), technically required constitute strong constraint case.Let’s say goal produce probability map stationary period accounting pressure measurements maintaining likely flights. corresponds marginal probability map \\(P(X_t=x_t|Y_0=y_0,...Y_t=y_t)\\). familiar lower capital case, \\(X_t\\) represents random variable (.e., position bird stationary period \\(t\\)), \\(x_t\\) specific value \\(X\\) can take, case, specific coordinates pixels map.number possible positions limited (.e., number pixels map), can solve HMM exactly. contrast Markov Chain Monte Carlo (MCMC) algorithm, assume discretization space relies iterative approach solve model.graph convenient mathematical representation model states (nodes) relations states (edges). Graphs general fundamental mathematical tool, use specific graph structure corresponding HMM presented : two states \\(X\\) \\(Y\\) time step \\(t\\) (nodes), observation movement model (relating \\(X_t\\) \\(X_t+1\\) \\(Y_t\\) \\(X_t\\) respectively). relationships assumed independent.Typically animal movement, graph used represent random variable HMM, case, also use concept graph store discrete positions (.e., pixels) bird timesteps, referred trellis graphs.can think nodes full 3D grid lat x lon x stationary period edges possible pairs nodes two consecutive stationary periods. can imagine, results high number edges! novelty Nussbaumer et al. (2023b) construct graph using useful nodes edges, thereby dramatically reducing computational resources required.","code":""},{"path":"trajectory.html","id":"create-the-graph","chapter":"3 Trajectory","heading":"3.2 Create the graph","text":"create trellis graph function graph_create(), performs following steps:Keep nodes locations within threshold percentile likelihood map thr_likelihood. instance, value 0.90 means keep pixels likelihood sums represent 90% total probability space.Keep nodes within reach least one node previous one next stationary period. done assuming maximal possible groundspeed thr_gs. key step efficiently computed image binary distance function EBImage::distmap().Build edges based filtered nodes groundspeed threshold thr_gs.Prune graph based flow graph constraint, , nodes must connected equipment node(s) retrieval node(s), avoid dead branches (nodes connected single direction).steps explained illustrated detail section 2.2 Nussbaumer et al. (2023b)","code":"\ngraph <- graph_create(tag,\n  thr_likelihood = 0.90,\n  thr_gs = 100, # km/h\n  quiet = TRUE\n)"},{"path":"trajectory.html","id":"set-movement-model","chapter":"3 Trajectory","heading":"3.3 Set movement model","text":"define movement model setting parametric function converting groundspeed probability.basic tutorial, use gamma distribution model probability groundspeed.birds may fly back forth small distances, give groundspeeds 15km/h probability 15 km/h parameter low_speed_fix.can visualize parametric function created plot_graph_movement()","code":"\ngraph <- graph_set_movement(graph,\n  method = \"gamma\",\n  shape = 7,\n  scale = 7,\n  low_speed_fix = 15\n)\nplot_graph_movement(graph)"},{"path":"trajectory.html","id":"products","chapter":"3 Trajectory","heading":"3.4 Products","text":"graph built, can now generate three main products GeoPressureR, presented detail section 2.3 Nussbaumer et al. (2023b).","code":""},{"path":"trajectory.html","id":"product-1-most-likely-path","chapter":"3 Trajectory","heading":"3.4.1 Product 1: Most likely path","text":"graph can directly efficiently compute likely path, , set positions stationary period maximizes joint probability trajectory. finds optimal compromise likely position according pressure (light) likelihood map realistic flight distance defined movement model.GeoPressureR, path standard data.frame created used several functions.","code":"\npath_most_likely <- graph_most_likely(graph, quiet = TRUE)\nkable(head(path_most_likely, 3))\nplot_path(path_most_likely)"},{"path":"trajectory.html","id":"product-2-marginal-probability-map","chapter":"3 Trajectory","heading":"3.4.2 Product 2: Marginal probability map","text":"Estimating uncertainty bird’s position stationary period generally sought-output tracking studies. pressure likelihood map provides information stationary period, can now produce probability map positions accounting observations transitions. HMM, maps correspond marginal distribution Markov process.can visualize marginal map along likely path:","code":"\nmarginal <- graph_marginal(graph, quiet = TRUE)\nplot(marginal, path = path_most_likely)"},{"path":"trajectory.html","id":"product-3-simulated-paths","chapter":"3 Trajectory","heading":"3.4.3 Product 3: Simulated paths","text":"want perform post-hoc computation trajectory (e.g., mean flight distance), convenient simulate multiple paths, compute metric (e.g., flight distance) compute summary statistics afterwards (e.g., mean).Note using forward filtering backward sampling algorithm, allowing sample trajectories independently without error.","code":"\npath_simulation <- graph_simulation(graph,\n  nj = 10, # Number of simulation\n  quiet = TRUE\n)\nplot_path(path_simulation, plot_leaflet = FALSE)"},{"path":"trajectory.html","id":"save","chapter":"3 Trajectory","heading":"3.5 Save","text":"might want save key objects tag marginal R format. Following default structure described GeoPressureTemplate, save \"./data/interim\" folder.Note graph can quite large number stationary periods grid resolution high.saving tag graph, also archive functions parameters used, can retrieved tag$param graph$param.","code":"\nsave(tag,\n  graph, # format(object.size(graph), units = \"MB\")\n  path_most_likely,\n  path_simulation,\n  marginal,\n  file = \"./data/interim/CB619.RData\"\n)"},{"path":"light-map.html","id":"light-map","chapter":"4 Light map","heading":"4 Light map","text":"advanced tutorial, construct three products Great Reed Warbler (18LX), time including light wind data.first chapter focuses constructing likelihood map light data. step optional workflow, can helpful case. Typically, quite informative short stopovers long flights . can also helpful cross-check pressure map can reduce computational cost creation graph., use approach based threshold method using calibration zenith angle (rather time sunrise). approach presented detail section 2.4 Nussbaumer et al. (2023a)thorough introduction geolocation light data can found geolocation manual (Lisovski et al., 2020). Note methods producing likelihood maps also used ones presented Basson et al. (2016) Bindoff et al. (2018).","code":""},{"path":"light-map.html","id":"basic-tutorial-catch-up","chapter":"4 Light map","heading":"4.1 Basic tutorial catch up","text":"getting light data, first need create, label, set map tag object. essentially perform steps tag object pressure map just lines using native pipe operator |>. Note assumes labelling already done.","code":"\ntag <- tag_create(\"18LX\",\n  crop_start = \"2017-06-20\",\n  crop_end = \"2018-05-02\",\n  quiet = TRUE\n) |>\n  tag_label(quiet = TRUE) |>\n  tag_set_map(\n    extent = c(-16, 23, 0, 50),\n    scale = 4,\n    known = data.frame(\n      stap_id = 1,\n      known_lat = 48.9,\n      known_lon = 17.05\n    )\n  ) |>\n  geopressure_map(quiet = TRUE)"},{"path":"light-map.html","id":"estimate-twilights","chapter":"4 Light map","heading":"4.2 Estimate twilights","text":"find twilight (time sunrise sunset every day) twilight_create(), performs tasks TwGeos::FindTwilight(), using matrix representation. approach faster less general (e.g., requires regularly spaced light data).default, threshold light twl_thr = NULL defined first last light day (.e., tag$light$vale>0). twl_offset parameter used center night/day matrix representation light. good centering necessary find correct twilights.can visualize twilight check centering day.Re-run twilight_create different twl_offset night/day properly centered.already label stationary period , plot indicates stationary period twilight belongs dot color. can useful distinguish outliers change bird position.","code":"\ntag <- twilight_create(tag, twl_thr = NULL, twl_offset = NULL)\nplot(tag, type = \"twilight\")"},{"path":"light-map.html","id":"manual-labelling-of-twilight","chapter":"4 Light map","heading":"4.3 Manual labelling of twilight","text":"Twilight outliers discarded analysis using Trainset https://trainset.raphaelnussbaumer.com/.Use twilight_label_write() generate twilight label csv file.Click “Upload Twilight Label” customize interface twilight labelling. Similar tag labelling, simply label twilights ignored \"discard\" label.Twilight outliers can picked visually don’t follow smooth line.color dots indicative stationary period can helpful pick outliers change bird’s position: changes twilight within stationary period smooth, changes positions can abrupt.Note modifying label twilight different stationary period influence later , \"discard\" labels read twilight_label_read().Avoid -edit calibration period. variability twilight important build calibration adequately captures range uncertainty twilight. easier pick outliers long stationary periods (calibration period) shorter ones, risk variability short stationary periods thus biases estimated position.finished labelling, export file folder keeping -labeled name (automatically added Trainset).","code":"\ntwilight_label_write(tag)## ✔ './data/twilight-label/18LX.csv' written successfully.\ntag <- twilight_label_read(tag)\nplot(tag, type = \"twilight\")"},{"path":"light-map.html","id":"compute-likelihood-map","chapter":"4 Light map","heading":"4.4 Compute likelihood map","text":"computation light likelihood map stationary period performed geolight_map() follows three steps:Perform calibration zenith angle (.e., angle sun sunrise sunset) kernel density (see stats::kernel()). requires knowing position bird least one stationary period. position specified known data.frame tag_set_map().Compute likelihood map twilight. step consists computing, pixel map, zenith angle corresponding probability using calibrated kernel distribution.Aggregate likelihood maps stationary period single map using log-linear pooling. See probability aggregation information log-linear pooling.twl_calib_adjust parameter adjusts smoothness fit (see stats::density()). zenith angle error model fitted data calibration site, using locations bird’s journey, safer assume broader/smoother distribution (twl_calib_adjust > 1).recommended always check calibration fit tag$param$twl_calib withFinally, can visualize probability map stationary period:worth checking likelihood map light pressure compare building graph. always overlap. case, tag /twilight labelling needs adjusted.task best performed GeoPressureViz, presented dedicated chapter. now, can simply visualize resulting likelihood map pressure light combine.","code":"\ntag <- geolight_map(tag,\n  twl_calib_adjust = 1.4,\n  twl_llp = function(n) log(n) / n,\n  quiet = TRUE\n)\nplot(tag$param$twl_calib)\nbarw <- median(diff(tag$param$twl_calib$x)) / 2\nrect(\n  xleft = tag$param$twl_calib$x - barw, ybottom = 0,\n  xright = tag$param$twl_calib$x + barw,\n  ytop = tag$param$twl_calib$y, col = gray(0.5)\n)\nlines(tag$param$twl_calib, col = \"red\")\nplot(tag, type = \"map_light\")\nplot(tag, type = \"map\")"},{"path":"trajectory-with-wind.html","id":"trajectory-with-wind","chapter":"5 Trajectory with wind","heading":"5 Trajectory with wind","text":"second chapter advanced tutorial, see model trajectory Great Reed Warbler using wind data.Wind can significantly influence bird’s movement, explaining 50% displacement! Accounting wind allows estimate airspeed transition rather groundspeed. , movement model can defined probability bird’s airspeed, much constrained precise. approach presented detail section 2.2.4 Nussbaumer et al. (2023b).","code":""},{"path":"trajectory-with-wind.html","id":"download-wind-data","chapter":"5 Trajectory with wind","heading":"5.1 Download wind data","text":"Wind data available high resolution (1hr, 0.25°, 37 pressure level) ERA5 hourly data pressure levels. data easily accessible ecmwfr package.first step set CDS access. need create account cds.climate.copernicus.eu generate API key uid number. can store environment variables .Renviron using usethis::edit_r_environ().flights tend short duration, suggest downloading file flight. can done automatically tag_download_wind(), uses wf_request_batch() make requests parallel.can monitor requests https://cds.climate.copernicus.eu/cdsapp#!/yourrequests. files downloaded data/wind/case lot tracks need download wind data don’t want block console, might consider using RStudio background job, can easily called job package:","code":"cds_key = \"Insert_your_CDS_API_KEY_here\"\ncds_user = \"Insert_your_CDS_UID_here\"\ntag_download_wind(tag)\njob::job({\n  tag_download_wind(tag)\n})"},{"path":"trajectory-with-wind.html","id":"create-graph","chapter":"5 Trajectory with wind","heading":"5.2 Create graph","text":"Similar example Swainson’s Warbler basic tutorial, first need create trellis graph:","code":"\ngraph <- graph_create(tag, quiet = TRUE)"},{"path":"trajectory-with-wind.html","id":"add-wind-to-graph","chapter":"5 Trajectory with wind","heading":"5.3 Add wind to graph","text":"compute average windspeed experienced bird edge graph. process can quite long need interpolate position bird along flight 4D grid (latitude-longitude-pressure level-time).compute airspeed based windspeed known groundspeed. stored complex values real part representing E-W component imaginary part corresponding N-S component.","code":"\ngraph <- graph_add_wind(graph, pressure = tag$pressure, quiet = TRUE)"},{"path":"trajectory-with-wind.html","id":"define-movement-model","chapter":"5 Trajectory with wind","heading":"5.4 Define movement model","text":"can still define movement model parametric function (.e., gamma logit), find intuitive use mechanical power curve. power curve expresses energy required bird fly certain airspeed based aerodynamic theory. See details section 2.2.5 Nussbaumer et al. (2023b).First, search morphological information Great Reed Warbler using AVONET database.Using bird created, can set movement model converting airspeed power, power probability. second step still parametric equation, can manually defined power2prob.","code":"\nbird <- bird_create(\"Acrocephalus arundinaceus\")\ngraph <- graph_set_movement(graph,\n  method = \"power\",\n  bird = bird,\n  power2prob = \\(power) (1 / power)^3,\n  low_speed_fix = 15\n)\nplot_graph_movement(graph)"},{"path":"trajectory-with-wind.html","id":"products-1","chapter":"5 Trajectory with wind","heading":"5.5 Products","text":"can compute three products Swainson’s Warbler:","code":"\npath_most_likely <- graph_most_likely(graph, quiet = TRUE)\nmarginal <- graph_marginal(graph, quiet = TRUE)\npath_simulation <- graph_simulation(graph, nj = 10, quiet = TRUE)\nplot(marginal, path = path_most_likely)\nplot_path(path_simulation, plot_leaflet = FALSE)"},{"path":"trajectory-with-wind.html","id":"extract-flight-information","chapter":"5 Trajectory with wind","heading":"5.5.1 Extract flight information","text":"pathvariable contains information scale stationary period. However, get flight information, need extract variable edge graph. path2edge() function !’s good idea check distribution ground speed (gs), winspeed (ws) airspeed () check outliers might come error labeling. can see high groundspeed (>100km/h stap 24 25) nicely explained wind, corresponding airspeed perfectly normal (~50km/h)can () also check movement model coherent distribution flight speed assumed movement model:find anomalous flight speed, might worth checking /flight(s) correctly labelled.","code":"\nedge_simulation <- path2edge(path_simulation, graph)\nedge_most_likely <- path2edge(path_most_likely, graph)\nknitr::kable(head(edge_most_likely, 3), digits = 1)\nedge_simulation$name <- glue::glue(\"{edge_simulation$stap_s}->{edge_simulation$stap_t}\")\nplot1 <- ggplot(edge_simulation, aes(reorder(name, stap_s), abs(gs))) +\n  theme_bw() +\n  ylab(\"gs\") +\n  geom_boxplot()\nplot2 <- ggplot(edge_simulation, aes(reorder(name, stap_s), abs(ws))) +\n  theme_bw() +\n  ylab(\"ws\") +\n  geom_boxplot()\nplot3 <- ggplot(edge_simulation, aes(reorder(name, stap_s), abs(gs - ws))) +\n  theme_bw() +\n  ylab(\"as\") +\n  geom_boxplot()\nplot4 <- ggplot(edge_simulation, aes(reorder(name, stap_s), duration)) +\n  theme_bw() +\n  ylab(\"duration\") +\n  geom_point()\n\nplotly::subplot(\n  plotly::ggplotly(plot1),\n  plotly::ggplotly(plot2),\n  plotly::ggplotly(plot3),\n  plotly::ggplotly(plot4),\n  nrows = 4, titleY = TRUE\n)\nplot_graph_movement(graph) +\n  geom_histogram(\n    data = data.frame(as = abs(edge_simulation$gs - edge_simulation$ws)),\n    aes(x = as, y = after_stat(count) / sum(after_stat(count))),\n    color = \"black\", fill = NA, bins = 100\n  )"},{"path":"trajectory-with-wind.html","id":"save-1","chapter":"5 Trajectory with wind","heading":"5.6 Save","text":"graph can become extremely big models might recommended save . Check size format(object.size(graph), units = \"MB\").","code":"\nsave(\n  tag,\n  # graph,\n  path_most_likely,\n  path_simulation,\n  marginal,\n  edge_simulation,\n  edge_most_likely,\n  file = \"./data/interim/18LX.RData\"\n)"},{"path":"pressurepath.html","id":"pressurepath","chapter":"6 Pressurepath","heading":"6 Pressurepath","text":"chapter, see pressurepath object use compute altitude bird throughout trajectory.Let’s load tag Great Reed Warbler (18LX) created advanced tutorial.","code":"\nload(\"./data/interim/18LX.Rdata\")"},{"path":"pressurepath.html","id":"timeseries-at-a-single-position","chapter":"6 Pressurepath","heading":"6.1 Timeseries at a single position","text":"creating full pressurepath, start basic building block pressurepath, retrieve pressure timeseries ERA5 single location geopressure_timeseries.geopressure_timeseries relies pressure timeseries entry point GeoPressureAPI return timeseries pressure given latitude longitude.Let’s start retrieving pressure known site equipment, querying date first stationary period.can compare retrieved ERA5 pressure pressure measured Great Reed Warbler:figure made realize potential pressure measurement determine birds’ position! accuracy reanalysis data precision sensor timeseries pressure possible options map.","code":"\nts <- geopressure_timeseries(\n  lat = tag$stap$known_lat[1],\n  lon = tag$stap$known_lon[1],\n  start_time = tag$stap$start[1],\n  end_time = tag$stap$end[1],\n  quiet = TRUE\n)"},{"path":"pressurepath.html","id":"pressurepath-1","chapter":"6 Pressurepath","heading":"6.2 Pressurepath","text":"can think pressurepath timeseries pressure tag record bird traveling along specified path. , pressurepath_create() calls geopressure_timeseries() stationary period combines resulting timeseries ERA5 pressure.pressurepath data.frame returned also contains original pressure pressure_tag can helpful labelling altitude bird corrected natural variation pressure.Note position path water, automatically moved closest point onshore use ERA5 Land.","code":"\npressurepath <- pressurepath_create(\n  tag,\n  path = path_most_likely,\n  quiet = TRUE\n)\nplot_pressurepath(pressurepath)"},{"path":"pressurepath.html","id":"altitude","chapter":"6 Pressurepath","heading":"6.3 Altitude","text":"main benefit creating pressurepath ability retrieve ERA5 variable along trajectory bird. One altitude can directly plot withComputing bird altitude \\(z_{gl}\\) pressure measurement \\(P_{gl}\\) best performed barometric equation\\[ z_{gl}=z_0 + \\frac{T_0}{L_b}  \\left( \\frac{P_{gl}}{P_0} \\right) ^{\\frac{RL_b}{g M}-1},\\]\\(L_b\\) standard temperature lapse rate, \\(R\\) universal gas constant, \\(g\\) gravity constant \\(M\\) molar mass air.typical assume standard atmosphere fixed \\(T_0=15°C\\), \\(P_0=1013.25 hPa\\) \\(z_0=0 m\\),However, know pressure temperature vary considerably time space, leading approximation altitude estimated.Using GeoPressureAPI, can adjust barometric equation actual ground-level pressure \\(P_{ERA}\\) ground temperature \\(T_{ERA}\\) retrieved ERA5 bird’s location \\(x\\),\n\\[ z_{gl}(x)=z_{ERA5}(x) + \\frac{T_{ERA5}(x)}{L_b}  \\left( \\frac{P_{gl}}{P_{ERA5}(x)} \\right) ^{\\frac{RL_b}{g M}-1},\\]See information GeoPressureAPI documentation.can compare two altitudes first stationary period,uncorrected altitude estimate incorrectly produces 200m amplitude error altitude due natural variation pressure. contrast, corrected altitude shows Great Reed Warbler mostly stayed location/altitude entire period.can also retrieve ground elevation path2elevation() allows us compare altitude flight compare elevation.Note imprecision position, particularly flight, ’s important analyse caution relationship flight altitude ground elevation. path2elevation() aggregate elevation accross larger area defined scale return different percentile.","code":"\nplot_pressurepath(pressurepath, type = \"altitude\")\nLb <- -0.0065\nR <- 8.31432\ng0 <- 9.80665\nM <- 0.0289644\nT0 <- 273.15 + 15\nP0 <- 1013.25\npressurepath$altitude_uncorrected <- T0 / Lb * ((pressurepath$pressure_tag / P0)^(-R * Lb / g0 / M) - 1)\np <- ggplot(pressurepath[pressurepath$stap_id == 1, ]) +\n  geom_line(aes(x = date, y = altitude, colour = \"Corrected elevation with ERA5\")) +\n  geom_line(aes(x = date, y = altitude_uncorrected, colour = \"Uncorrected elevation\")) +\n  theme_bw() +\n  ylab(\"Pressure (hPa)\") +\n  scale_color_manual(values = c(\"Corrected elevation with ERA5\" = \"black\", \"Uncorrected elevation\" = \"red\"))\nplotly::layout(plotly::ggplotly(p), legend = list(orientation = \"h\"))\nelevation <- path2elevation(path_most_likely,\n  scale = tag$param$scale,\n  sampling_scale = tag$param$scale * 2,\n  percentile = c(10, 50, 90)\n)\n# Compute distance along the path for pressurepath (to be able to plot it with elevation)\nlonlat <- data.frame(\n  lon = pressurepath$lon,\n  lat = pressurepath$lat\n)\ndistance <- geosphere::distHaversine(tail(lonlat, -1), head(lonlat, -1))\npressurepath$distance <- c(0, cumsum(distance))\n\n# Get also a point per stap_id\n# exclude flight\npp <- pressurepath[pressurepath$stap_id == round(pressurepath$stap_id), ]\n# compute average flight and distance\npp_stap <- merge(\n  tag$stap,\n  data.frame(\n    stap_id = sapply(split(pp$stap_id, pp$stap_id), median),\n    altitude = sapply(split(pp$altitude, pp$stap_id), \\(x) round(mean(x), 1)),\n    distance = sapply(split(pp$distance, pp$stap_id), \\(x) round(mean(x), 1))\n  )\n)\npp_stap$duration <- stap2duration(pp_stap)\n\n# Plot\np <- ggplot() +\n  geom_line(data = elevation, aes(x = distance / 1000, y = X50, color = \"ground\")) +\n  geom_line(data = pressurepath, aes(x = distance / 1000, y = altitude, color = \"flight\")) +\n  geom_point(data = pp_stap, aes(x = distance / 1000, y = altitude, name = stap_id, color = \"stap\", size = duration^(0.25) * 6)) +\n  theme_bw() +\n  ylab(\"altitude/elevation (m a.s.l.)\") +\n  xlab(\"Distance along trajectory (km)\") +\n  scale_color_manual(\n    values = c(ground = \"brown\", flight = \"black\", stap = \"blue\"),\n    labels = c(ground = \"Ground elevation (median over 0.25°)\", flight = \"Bird flight altitude\", stap = \"Stationary period\")\n  ) +\n  guides(size = FALSE)\n\n# Interactive plot\nplotly::layout(plotly::ggplotly(p), legend = list(orientation = \"h\"))"},{"path":"pressurepath.html","id":"save-2","chapter":"6 Pressurepath","heading":"6.4 Save","text":"graph object can become extremely big models, might recommended save . Check size format(object.size(graph), units = \"MB\").","code":"\nsave(\n  tag,\n  # graph,\n  pressurepath,\n  path_most_likely,\n  path_simulation,\n  marginal,\n  file = \"./data/interim/18LX.RData\"\n)"},{"path":"geopressureviz.html","id":"geopressureviz","chapter":"7 GeoPressureViz","heading":"7 GeoPressureViz","text":"GeoPressureR includes shiny app GeoPressureViz helps visualize overall trajectory bird well step--step move. Note visualization tool , used make changes data. offers useful tool label tag provides convenient platform discuss overall trajectory collaborators.Screenshot GeoPressureViz demo showing estimated position one stationary period Great Reed Warbler (18LX), based (1) pressure light match (map colorscale timeseries) (2) potential flight distances previous next stationary periods (circles).","code":""},{"path":"geopressureviz.html","id":"navigate-geopressureviz","chapter":"7 GeoPressureViz","heading":"7.1 Navigate GeoPressureViz","text":"Open demo 18LXOpen demo 18LXThe app three panels:\nMap: displays trajectory bird. size circles indicates duration stopover (hover get info).\nBottom panel: shows pressurepath trajectory must computed beforehand. grey line raw data (pressurepath$pressure_tag), black dots pressure points labelled outliers, colored lines normalized pressure best match location (.e., pressurepath$surface_pressure_norm). color matches circles map.\nSide panel: provides key information tools navigate app.\napp three panels:Map: displays trajectory bird. size circles indicates duration stopover (hover get info).Map: displays trajectory bird. size circles indicates duration stopover (hover get info).Bottom panel: shows pressurepath trajectory must computed beforehand. grey line raw data (pressurepath$pressure_tag), black dots pressure points labelled outliers, colored lines normalized pressure best match location (.e., pressurepath$surface_pressure_norm). color matches circles map.Bottom panel: shows pressurepath trajectory must computed beforehand. grey line raw data (pressurepath$pressure_tag), black dots pressure points labelled outliers, colored lines normalized pressure best match location (.e., pressurepath$surface_pressure_norm). color matches circles map.Side panel: provides key information tools navigate app.Side panel: provides key information tools navigate app.“Minimum duration” input allows filter short stationary periods map, similarly include_min_duration tag_set_map().“Minimum duration” input allows filter short stationary periods map, similarly include_min_duration tag_set_map().Toggle “Full Track” button move stationary period view.Toggle “Full Track” button move stationary period view.Navigate one stationary period next using previous/next button dropdown list. pressure timeseries update zoom exactly stationary period. color timeseries informs current stationary period shown map, two others begin previous next one.Navigate one stationary period next using previous/next button dropdown list. pressure timeseries update zoom exactly stationary period. color timeseries informs current stationary period shown map, two others begin previous next one.circles indicates distance previous next stationary period location based speed slider side panel (default 40km/h).circles indicates distance previous next stationary period location based speed slider side panel (default 40km/h).Depending maps available, can choose display probability map pressure tag$map_pressure, light tag$map_light, product, marginal.Depending maps available, can choose display probability map pressure tag$map_pressure, light tag$map_light, product, marginal.locations likely path can completely , might helpful temporarily change location check coherence distance next/previous stationary period. Click “Start Editing” Every time click map, update position. ’re happy position, can click button disable editing mode.locations likely path can completely , might helpful temporarily change location check coherence distance next/previous stationary period. Click “Start Editing” Every time click map, update position. ’re happy position, can click button disable editing mode.Finally, can also check pressure timeseries new positions using button “Query pressure”. runs geopressure_timeseries() background, slow (especially long stationary periods).Finally, can also check pressure timeseries new positions using button “Query pressure”. runs geopressure_timeseries() background, slow (especially long stationary periods).","code":""},{"path":"geopressureviz.html","id":"run-geopressureviz","chapter":"7 GeoPressureViz","heading":"7.2 Run GeoPressureViz","text":"visualization can started track using geopressureviz().data stored \"./data/interim/18LX.RData\", can use directlyNote path shiny app can retrieved global environment using geopressure_path.","code":"\nload(\"./data/interim/18LX.RData\")\ngeopressureviz(\n  tag = tag, # required\n  pressurepath = pressurepath, # optional\n  marginal = marginal, # optional\n)\ngeopressureviz(\"18LX\")"},{"path":"labelling-tracks.html","id":"labelling-tracks","chapter":"8 Labelling tracks","heading":"8 Labelling tracks","text":"last chapter, tackle challenge labelling tag!chapter assumes familiar overall process GeoPressureR presented Basic tutorial, well concept pressurepath use GeopressureViz.","code":""},{"path":"labelling-tracks.html","id":"labelling-principles","chapter":"8 Labelling tracks","heading":"8.1 Labelling principles","text":"Labelling tracks imperative GeoPressureR requires highly precise well-defined pressure timeseries fixed/constant location horizontally (geographical: +/- 10-50km) vertically (altitude: +/- 2m).procedure involves labelling datapoint (1) flight label bird active migratory flight (2) discard label pressure datapoints discarded matching exercise. overall objective create pressure timeseries stationary period bird can assumed remain location elevation entire period.Labelling flight defines stationary periods flight duration. stationary period period bird considered static relative size grid (~10-50km). start end stationary period used define pressure timeseries matched. accurate flight duration critical correctly estimate distance traveled bird two stationary periods.Labelling flight defines stationary periods flight duration. stationary period period bird considered static relative size grid (~10-50km). start end stationary period used define pressure timeseries matched. accurate flight duration critical correctly estimate distance traveled bird two stationary periods.Labelling discard eliminates vertical (altitudinal) movements bird. algorithm matching pressure timeseries sensitive small pressure variations hPa, even altitudinal movements couple meters can throw estimation map short stationary periods. Since reanalysis data matched provided single pressure level, must discard data points corresponding different elevation.Labelling discard eliminates vertical (altitudinal) movements bird. algorithm matching pressure timeseries sensitive small pressure variations hPa, even altitudinal movements couple meters can throw estimation map short stationary periods. Since reanalysis data matched provided single pressure level, must discard data points corresponding different elevation.species’ migration behaviour specific manual editing remains fastest option. Indeed, small changes pressure activity can correspond either local movement slow migration. Expertise bird’s expected migration style essential correctly label tracks. label, learn bird moving (e.g. long continuous high altitude flights, short flights multiple days, alternation short migration flights stopovers, etc.). Manual editing also gives sense uncertainty labelling, useful interpret results.","code":""},{"path":"labelling-tracks.html","id":"with-or-without-acceleration-data","chapter":"8 Labelling tracks","heading":"8.2 With or without acceleration data","text":"Acceleration data can significantly improve understanding bird activity movement. One main strength refine short stationary periods flights end night, birds tend flight low. addition, acceleration typically recorded higher temporal resolution (5min), can refine flight duration thus movement model building trajectory.acceleration data available, use flight label acceleration timeseries, discard label pressure timeseries.absence acceleration data, labels applied pressure timeseries.Let’s see example using acceleration data 18LX.Acceleration can used initialize flight label automatically. tag_label_auto() first classifies low high activity using k-mean clustering, identifies labels long periods high activity (e.g., lasting 30 minutes) flights.classification methods described PALMr manual.","code":"\ntag <- tag_create(\"18LX\",\n  crop_start = \"2017-06-20\",\n  crop_end = \"2018-05-02\"\n)\n## ✔ Read './data/raw-tag/18LX/18LX_20180725.pressure'\n## ✔ Read './data/raw-tag/18LX/18LX_20180725.glf'\n## ✔ Read './data/raw-tag/18LX/18LX_20180725.acceleration'\n## ✔ Read './data/raw-tag/18LX/18LX_20180725.temperature'\ntag <- tag_label_auto(tag, min_duration = 30)\nplot(tag, type = \"acceleration\")"},{"path":"labelling-tracks.html","id":"the-process","chapter":"8 Labelling tracks","heading":"8.3 The process","text":"Labelling iterative process need check validity pressure timeseries given stationary period reanalysis data several times. can expect spend 30sec 30min per track, depending species’ complexity (acceleration data, number flights, altitude flight etc…).tag_label() function can used guide entire labelling process, also outline step :subsequent modification csv file \"./data/tag-label/18LX-labeled.csv\" can directly processed (steps 4-5) using tag_label().","code":"\n# 1. Create the csv label file `\"./data/tag-label/18LX.csv\"`\ntag_label_write(tag)\n\n# 2. Edit csv file on TRAINSET\n# *on TRAINSET*\n\n# 3. Export csv file `\"./data/tag-label/18LX-labeled.csv\"`\n# *on TRAINSET*\n\n# 4. Read exported label file\ntag <- tag_label_read(tag)\n\n# 5. Compute stationary period data.frame tag$stap\ntag <- tag_label_stap(tag)"},{"path":"labelling-tracks.html","id":"introduction-to-trainset","chapter":"8 Labelling tracks","heading":"8.4 Introduction to TRAINSET","text":"suggesting using TRAINSET, web-based graphical tool labelling timeseries.customized original TRAINSET app smoother experience labelling tags twilight data: https://trainset.raphaelnussbaumer.com/Please use new version report issues bugs Github repository.Start uploading .csv file (e.g., data/tag-label/18LX.csv) using “Upload Tag Label” button.tips:Keyboard shortcuts can considerably speed navigation (zoom /, move left/right) labelling (add/remove label)., e.g. using SHIFT.large number datapoints, keep narrow temporal window avoid browser becoming slow unresponsive.Change Active Series Reference Series depending labelling use timeseries time help determine bird might .Adapt y-axis range stationary period see small (essential) pressure variations visible full view.","code":""},{"path":"labelling-tracks.html","id":"elevation-period","chapter":"8 Labelling tracks","heading":"8.5 Elevation period","text":"common birds change elevation level within stationary period (e.g., roost vs feeding site altitudinal movements mountainous species). movements can result drastic variations pressure, interfere ERA5 matching exercise.circumvent issue preserving much data possible match, can label pressure data different elevation levels using elev_x TRAINSET , click + sign bottom right create new elevation level (e.g., elev_1). Assign new label pressure datapoints belonging elevation period. can use multiple elevation periods, computational reasons, try limit minimum. Unlabelled datapoints can essentially thought evel_0.Note elevation levels continuous: ’s even better elevation period comes back several times stationary period. instance, can unlabelled datapoints feeding site every day labelled datapoints roosting location every night elev_1.Note can restart count elev_x new stationary period (e.g., datapoints stap 1 labelled elev_1 connected datapoints stap 2 also labelled elev_1).","code":""},{"path":"labelling-tracks.html","id":"labelling-checks","chapter":"8 Labelling tracks","heading":"8.6 Labelling checks","text":"Use checks outlined evaluate improve quality labelling.","code":""},{"path":"labelling-tracks.html","id":"simple-checks","chapter":"8 Labelling tracks","heading":"8.6.1 Simple checks","text":"Check 1: Duration stationary periods flightsThe first test consists checking duration flights stationary periods. systematically checked computing stationary periods message give feedback find potential errors:, used label produced tag_label_auto() without making edits TRAINSET. cases, common error flight cut bird inactive data-points. can correct cleaning flights TRAINSET.Check 2: Pressure timeseriesHere visually inspect pressure timeseries stationary period (1) correctly grouped (2) include pressure outliers (e.g., altitudinal movements). worth zooming-panning individual stationary period manually inspect timeseries.can acceptable stationary periods/flights shorter warning threshold check 1 2. Feel free overwrite default warning (e.g., warning_flight_duration).However, many stationary periods lead slow code number likelihood maps , importantly, size graph become excessively large. parameter include_min_duration tag_set_map() particularly useful: allows ignore short stationary periods merge flights.Note, MSE mismatch usually useful stationary period shorter hours, single high low pressure datapoint can indicate high low altitude location common map!","code":"\ntag <- tag_label(tag, \"./data/tag-label/18LX-labeled-v1.csv\")\n## \n## ── Short stationary periods (<6hr):\n## ! Stap 7 (2017-08-30 23:47 - 2017-08-30 23:52) : 5m\n## ! Stap 26 (2018-04-15 14:57 - 2018-04-15 18:47) : 3h 49m 60s\n## ! Stap 27 (2018-04-15 19:32 - 2018-04-15 20:07) : 35m\n## ! Stap 30 (2018-04-29 23:37 - 2018-04-29 23:42) : 5m\n## ! Stap 32 (2018-04-30 19:22 - 2018-04-30 19:37) : 15m\n## ! Stap 33 (2018-04-30 21:47 - 2018-04-30 21:52) : 5m\n## ! Stap 34 (2018-04-30 23:02 - 2018-04-30 23:07) : 5m\n## ! Stap 35 (2018-05-01 00:02 - 2018-05-01 00:07) : 5m\n## \n## ── Short flights (<2hr):\n## ! Flight 14 -> 15 (2017-09-11 23:32 - 2017-09-12 00:22) : 50m\n## ! Flight 18 -> 19 (2017-09-19 23:32 - 2017-09-20 00:42) : 1h 10m\n## ! Flight 26 -> 27 (2018-04-15 18:47 - 2018-04-15 19:32) : 45m\n## ! Flight 27 -> 28 (2018-04-15 20:07 - 2018-04-15 21:37) : 1h 30m\n## ! Flight 31 -> 32 (2018-04-30 18:37 - 2018-04-30 19:22) : 45m\n## ! Flight 33 -> 34 (2018-04-30 21:52 - 2018-04-30 23:02) : 1h 10m\n## ! Flight 34 -> 35 (2018-04-30 23:07 - 2018-05-01 00:02) : 55m\n## ! Flight 35 -> 36 (2018-05-01 00:07 - 2018-05-01 00:47) : 40m\ntag <- tag_label(tag, \"./data/tag-label/18LX-labeled-v2.csv\")\n## \n## ── Short stationary periods (<6hr):\n## ! Stap 25 (2018-04-15 15:02 - 2018-04-15 18:47) : 3h 45m\n## \n## ── Short flights (<2hr):\n## ! Flight 13 -> 14 (2017-09-11 23:32 - 2017-09-12 00:22) : 50m\n## ! Flight 17 -> 18 (2017-09-19 23:32 - 2017-09-20 01:07) : 1h 35m\nplot(tag, type = \"pressure\")\n## \n## ── Pre-processed pressure data length\n## ✔ All stationary periods have more than 12 datapoints.\n## \n## ── Pressure difference\n## → 2 timestamps show abnormal hourly change in pressure (i.e., >3hPa):\n## ! 2017-09-01 10:30:00 | stap: 8 | 3.8 hPa\n## ! 2017-10-01 17:30:00 | stap: 18 | 3 hPa"},{"path":"labelling-tracks.html","id":"pressurepath-checks","chapter":"8 Labelling tracks","heading":"8.6.2 Pressurepath checks","text":"second set checks complex computationally costly allows fine-tune final trajectory. Depending species preference, can done order parrellel.general idea perform following steps iteratively:Estimate current best guess trajectory (.e. path)Compute ERA5 pressure path (.e., pressurepath),Compare ERA5 pressure tag pressureRefine label accordingly: (1) label outliers, (2) merge split stationary periods, (3) use elev_x label.First, let’s compute light pressure likelihood maps coarse map (e.g. scale = 1) low precision mismatch (e.g. max_sample = 50) minimize computational cost.Check 3: Pressure timeseries matchFrom maps, can compute path goes stationary periods highest probability.Note path likely realistic movement model included (.e., limitation bird flight duration). fine stage: don’t really want assume realistic path, just see pressure can tell us without assuming anything. Using path, can retrieve ERA5 pressure along path,can compare pressure timeseries tag (grey) pressurepath. Zoom stationary period get better sense likely natural variation pressure.conversion mean squared error (MSE) likelihood performed geopressure_map_likelihood() assumes error distribution pressure normally distributed. important consequences perform well presence large errors, typically resulting map single possible pixel.Assuming normal distribution allows us define formally outliers value outside +/- 3 standard deviation (warning_std_thr). standard deviation defined parameter sd, default value 1.plot_pressurepath() displays outliers orange triangle can check manually.Besides outliers, can use figure identify period mismatch geolocator ERA5, usually indicative altitudinal movement bird. Depending situation, multiple ways labelling mismatch.easiest case, bird simply flew within stationary site (<10-50km) short time came back location. case, can simply discard pressure timeseries temporary change altitude.bird changes altitude never comes back elevation, can either consider new altitude new stationary period label activity data, can discard timeseries shorter period. essential resulting timeseries matches ERA5 pressure everywhere. Matches usually better longer periods. Looking activity data period can also help understand bird .bird changes back forth two elevation levels, use elev_x label label accordingly.general guideline, better remove bit long stationary periods get better estimation position. can iteratively removing bit seeing whether position improves result.’re happy new labels, update tag object. avoid running geopressure_map() pressurepath_create() full timeseries, use tag_upate() pressurepath_upate() update stationary periods changed.Check 4: Histogram pressure errorIn addition pressure timeseries, can also look histogram pressure error geolocator ERA5 timeseries.long stationary periods (5 days), want check single mode distribution. Two modes indicate bird spending time two different altitudes. usual birds day site night roost different elevations. cases, use elev_x label.red vertical dotted line indicates +/-3 sd can helpful identify potential outliers (.e., identical orange dot timeseries plot).Stationary periods empirical sd greater one used (sd) highlighted red. likelihood map stationary periods might correct.mentioned pressure map, sd adjusted data. Assuming position pressurepath\ncorrect, can use empirical sd value displayed histogram guide setting standard deviation parameter sd geopressure_map().Note can use different sd value account stationary periods high altitudinal variation (e.g. mountainous areas), keeping low sd value bird low-topography area.case, sd=1 (default value) seems adequate, though 0.8-0.9 might offer precision positioning.","code":"\ntag <- tag_create(\"18LX\", crop_start = \"2017-06-20\", crop_end = \"2018-05-02\", quiet = TRUE) |>\n  tag_label(\"./data/tag-label/18LX-labeled-v3.csv\", quiet = TRUE) |>\n  tag_set_map(\n    extent = c(-16, 23, 0, 50),\n    scale = 1,\n    known = data.frame(\n      stap_id = 1,\n      known_lat = 48.9,\n      known_lon = 17.05\n    )\n    # include_min_duration = 24 # Filtering long stap might also be useful at first\n  ) |>\n  geopressure_map(max_sample = 50, quiet = TRUE)\n\ntag <- tag |>\n  twilight_create() |>\n  twilight_label_read() |>\n  geolight_map(quiet = TRUE)\npath <- tag2path(tag)\npressurepath <- pressurepath_create(tag, path = path, quiet = TRUE)\nplot_pressurepath(pressurepath)\ntag2 <- tag_update(tag, file = \"./data/tag-label/18LX-labeled-v4.csv\", quiet = TRUE)\npressurepath <- pressurepath_update(pressurepath, tag, quiet = TRUE)\nplot_pressurepath(pressurepath, type = \"hist\", plot_plotly = FALSE)## Warning: Removed 12523 rows containing missing values (`geom_vline()`).\n## Removed 12523 rows containing missing values (`geom_vline()`)."},{"path":"labelling-tracks.html","id":"geopressureviz-checks","chapter":"8 Labelling tracks","heading":"8.6.3 GeoPressureViz checks","text":"Check 5: GeoPressureVizThe shiny app GeoPressureViz another important tool used instead parallel pressurepath checks. main advantages using apps areOnly query pressurepath position need checked “query pressure”.Quickly test pressurepath different position using “Start editing”.Separate likelihood pressure light well flight duration see agree/disagreeFilter-short stationary period see coherent, refining trajectory adding shorter ones.details app use can found GeopressureViz chapter.good test building graph, see can manually roughly draw path combination pressure/light maps flight duration.able move position trajectory flight distances realistic positing likely according likelihood maps.Remember birds can much higher groundspeed wind blowing way (150km/h instance) - extremes usually restricted long flights. cases, circle GeopressureViz look small, ’s ok.","code":"\ngeopressureviz(tag, # required\n               # path = pressurepath,\n)"},{"path":"labelling-tracks.html","id":"final-checks","chapter":"8 Labelling tracks","heading":"8.6.4 Final checks","text":"Check 6: Marignal likely pathLabelling finally checked end workflow using marginal -likely path.figure can checked hopefully everything matches well now! , important troubleshoot!last check geopressureviz highly recommended see difference likelihood maps marginal map. Remember models good data provided!","code":"\n# Update tag and pressurepath\ntag <- tag_update(tag, file = \"./data/tag-label/18LX-labeled.csv\", quiet = TRUE)\n\n# Build graph, add wing, add movement\ngraph <- graph_create(tag, quiet = TRUE) |>\n  graph_add_wind(tag$pressure, quiet = TRUE) |>\n  graph_set_movement(bird = bird_create(\"Acrocephalus arundinaceus\"))\n\n# Compute most likely path\npath_most_likely <- graph_most_likely(graph, quiet = TRUE)\n\n# Compute marginal\nmarginal <- graph_marginal(graph, quiet = TRUE)\n\n# Compute the corresponding pressurepath\npressurepath_most_likely <- pressurepath_create(tag, path = path_most_likely, quiet = TRUE)\nplot_pressurepath(pressurepath_most_likely)\nplot_pressurepath(pressurepath_most_likely, type = \"hist\", plot_plotly = FALSE)## Warning: Removed 12136 rows containing missing values (`geom_vline()`).\n## Removed 12136 rows containing missing values (`geom_vline()`).\ngeopressureviz(tag,\n               path = pressurepath_most_likely,\n               marginal = marginal\n)"},{"path":"resources.html","id":"resources","chapter":"A Resources","heading":"A Resources","text":"","code":""},{"path":"resources.html","id":"publications","chapter":"A Resources","heading":"A.1 Publications","text":"Nussbaumer, R., Gravey, M., Briedis, M., & Liechti, F. (2023). Global positioning animal-borne pressure sensors. Methods Ecology Evolution, 14, 1104–1117. https://doi.org/10.1111/2041-210X.14043Nussbaumer, R., Gravey, M., Briedis, M., Liechti, F. & Sheldon, D. (2023) Reconstructing bird trajectories pressure wind data using highly optimised hidden Markov model. Methods Ecology Evolution, 14, 1118–1129. https://doi.org/10.1111/2041-210X.14082","code":""},{"path":"resources.html","id":"presentations","chapter":"A Resources","heading":"A.2 Presentations","text":"Raphaël Nussbaumer. GeoPressureR: Introduction case studies. August 2023. 14th European Ornithologicals’ Union Congress. PRESENTATION available PDF.Raphaël Nussbaumer, Colin Jackson, Lennox Kirao, Felix Liechti. potential multi-sensor geolocators study short-distance Afrotropical migrants. November 2022. 15th Pan-African Ornithological Congress. PRESENTATION available PDF.Raphaël Nussbaumer, Mathieu Gravey, Martins Briedis, Felix Liechti. Leveraging light, pressure, activity, wind data improve geolocator positioning. August 2022. 28th International Ornithological Congress. PRESENTATION available Youtube PDF.Raphaël Nussbaumer, Mathieu Gravey, Felix Liechti. Improving spatial accuracy multi-sensor geolocators’ position using atmospheric surface pressure. October 2021. 7th International Bio-logging Science Symposium. PRESENTATION available Youtube PDF.","code":""},{"path":"resources.html","id":"projects-using-geopressurer","chapter":"A Resources","heading":"A.3 Projects using GeoPressureR","text":"can find list research projects using GeoPressureR links code used analyse create figures. might helpful get idea analyse data borrow code sections project. Feel free contact ’d like add project list.","code":""},{"path":"export-and-visual.html","id":"export-and-visual","chapter":"B Export and Visual","heading":"B Export and Visual","text":"chapter, see create additional figures export data.","code":"\nload(\"./data/interim/18LX.Rdata\")"},{"path":"export-and-visual.html","id":"export-to-open-format","chapter":"B Export and Visual","heading":"B.1 Export to open format","text":"addition saving graph object, might want export three products. recommend storing \"./data/processed\" standard format can opened softwares.data.frame formats (e.g., stap, pressurepath, path_most_likely etc…), .csv best option.","code":""},{"path":"export-and-visual.html","id":"stationary-periods","chapter":"B Export and Visual","heading":"B.1.1 Stationary periods","text":"can add additional information stationary periods altitude duration:Note likely path contains information stap used instead want best estimate coordinates stationary periods.","code":"\n# Compute summary stats of altitude, grouped by stap_id\nstap <- merge(\n  tag$stap,\n  data.frame(\n    stap_id = sapply(split(pressurepath$stap_id, pressurepath$stap_id), median),\n    alt_mean = sapply(split(pressurepath$altitude, pressurepath$stap_id), \\(x) round(mean(x), 1)),\n    alt_med = sapply(split(pressurepath$altitude, pressurepath$stap_id), \\(x) round(median(x), 1)),\n    alt_min = sapply(split(pressurepath$altitude, pressurepath$stap_id), \\(x) round(min(x), 1)),\n    alt_max = sapply(split(pressurepath$altitude, pressurepath$stap_id), \\(x) round(max(x), 1))\n  )\n)\n\n# The duration can also be computed with\nstap$duration <- round(stap2duration(stap), 2)\n\nwrite.csv(stap, glue::glue(\"./data/processed/{tag$param$id}/stap.csv\"), row.names = FALSE)"},{"path":"export-and-visual.html","id":"flights","chapter":"B Export and Visual","heading":"B.1.2 Flights","text":"Similarly, flights can also exported:","code":"\npp_f <- pressurepath[pressurepath$stap_id != round(pressurepath$stap_id), ]\npp_f$stap_s <- floor(pp_f$stap_id)\npp_f$stap_t <- ceiling(pp_f$stap_id)\n\nflight <- merge(\n  stap2flight(tag$stap),\n  data.frame(\n    stap_s = sapply(split(pp_f$stap_s, pp_f$stap_s), median),\n    stap_t = sapply(split(pp_f$stap_t, pp_f$stap_s), median),\n    alt_mean = sapply(split(pp_f$altitude, pp_f$stap_s), \\(x) round(mean(x), 1)),\n    alt_med = sapply(split(pp_f$altitude, pp_f$stap_s), \\(x) round(median(x), 1)),\n    alt_min = sapply(split(pp_f$altitude, pp_f$stap_s), \\(x) round(min(x), 1)),\n    alt_max = sapply(split(pp_f$altitude, pp_f$stap_s), \\(x) round(max(x), 1))\n  )\n)\n\nwrite.csv(flight, glue::glue(\"./data/processed/{tag$param$id}/flight.csv\"), row.names = FALSE)"},{"path":"export-and-visual.html","id":"geopressurer-maps","chapter":"B Export and Visual","heading":"B.1.3 GeoPressureR maps","text":"GeoPressureR maps can exported .geotiff file using terra::writeRaster convert terra::rast using rast.map().","code":"\nterra::writeRaster(rast.map(tag$map_pressure),\n  glue::glue(\"./data/processed/{tag$param$id}/map_pressure.tif\"),\n  filetype = \"GTiff\", overwrite = TRUE\n)\nterra::writeRaster(rast.map(tag$map_light),\n  glue::glue(\"./data/processed/{tag$param$id}/map_light.tif\"),\n  filetype = \"GTiff\", overwrite = TRUE\n)\nterra::writeRaster(rast.map(marginal),\n  glue::glue(\"./data/processed/{tag$param$id}/map_marginal.tif\"),\n  filetype = \"GTiff\", overwrite = TRUE\n)"},{"path":"export-and-visual.html","id":"parameters","chapter":"B Export and Visual","heading":"B.1.4 Parameters","text":"entire workflow, tag$param graph$param record essential parameters used create likelihood map graph. therefore interesting export structure reproducibility.","code":"\nwrite(jsonlite::toJSON(graph$param, auto_unbox = TRUE, pretty = TRUE, force = TRUE),\n  file = glue::glue(\"./data/processed/{tag$param$id}/param.json\")\n)"},{"path":"export-and-visual.html","id":"visuals","chapter":"B Export and Visual","heading":"B.2 Visuals","text":"","code":""},{"path":"export-and-visual.html","id":"movevis","chapter":"B Export and Visual","heading":"B.2.1 Movevis","text":"Let’s try create beautiful visual trajectories using MoveVis.path encodes position entire stationary period, need produce data.frame position start end stationary period. can following function:worth checking frame looks like generating entire gif (takes around 10 min compute), using:’re satisfied, go !map! Check moveVis examples ideas.","code":"\nlibrary(moveVis)\npath_most_likely$duration <- stap2duration(path_most_likely)\n\nm <- df2move(path_most_likely,\n  proj = \"+init=epsg:4326 +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\",\n  x = \"lon\", y = \"lat\", time = \"start\", track_id = \"j\"\n)\n\n# Use midday position rather than midnight (while the bird could be flying)\nm <- align_move(m, res = 24, unit = \"hours\", digit = 12)\n\n# remove the long equipement and retrival period duration\nm <- subset_move(m,\n  from = max(min(m$time), tag$stap$end[1] - 3 * 60 * 60 * 24),\n  to = min(max(m$time), tail(tag$stap$start, 1) + 3 * 60 * 60 * 24)\n)\n\n# Create frames\nframes <- frames_spatial(m, equidistant = TRUE, ext = raster::extent(tag$param$extent)) |>\n  add_labels(x = NULL, y = NULL) |> # add some customizations, such as axis labels\n  add_timestamps(type = \"label\", size = 6) |>\n  add_progress()\nplot(frames[[100]])\nanimate_frames(frames, out_file = glue::glue(\"./assets/movevis_{tag$param$id}.gif\"), height = 1000, width = 1000, overwrite = T)"},{"path":"export-and-visual.html","id":"ggpmap","chapter":"B Export and Visual","heading":"B.2.2 ggpmap","text":"Enter google map API (see documentation ?register_google())","code":"\nlibrary(ggmap)\nlibrary(cowplot)\nregister_google(\"googlemap_key\")\nistap_winter <- which(stap2duration(tag$stap) > 50)[2]\n\np0 <- get_googlemap(\n  center = c(lon = path_most_likely$lon[istap_winter], lat = path_most_likely$lat[istap_winter]),\n  zoom = 9, maptype = \"hybrid\", size = c(1280, 1280), scale = 4\n) |>\n  ggmap() + theme_map()\n# Convert to data.frame\ndf <- rast.map(marginal)[[istap_winter]] |>\n  terra::disagg(5, method = \"bilinear\") |>\n  as.data.frame(xy = TRUE)\nnames(df)[3] <- \"layer\"\n\n# Compute the percentile\ndf <- df[!is.na(df$layer), ]\ndf <- df[order(df$layer), ]\ndf$layerP <- 1 - cumsum(df$layer) / sum(df$layer)\n\n# Add plot\np <- p0 +\n  geom_contour(df, aes(x = x, y = y, z = layerP, color = after_stat(level)), linewidth = 2, breaks = c(.5, .1)) +\n  scale_colour_gradient(\n    high = \"red\",\n    low = \"white\",\n    limits = c(0, .1),\n    guide = \"none\"\n  )\nplot_inset <- ggplot() +\n  borders(\"world\", colour = \"gray90\", fill = \"gray50\", linewidth = 0.1) +\n  coord_quickmap(\n    xlim = c(-18, 51),\n    ylim = c(-35, 37),\n    expand = FALSE\n  ) +\n  geom_rect(\n    aes(\n      xmin = layer_scales(p0)$x$range$range[1],\n      xmax = layer_scales(p0)$x$range$range[2],\n      ymin = layer_scales(p0)$y$range$range[1],\n      ymax = layer_scales(p0)$y$range$range[2]\n    ),\n    color = \"red\", alpha = 0.1, linewidth = 1\n  ) +\n  theme_map() +\n  theme(\n    panel.border = element_rect(colour = \"black\", fill = NA, linewidth = 1),\n    panel.background = element_rect(fill = \"#FFFFFF\")\n  )\n\npf <- ggdraw() +\n  draw_plot(p) +\n  draw_plot(plot_inset, x = .15, y = .06, width = 0.35, height = 0.35)\nggsave(plot = pf, \"assets/wintering_location.png\")"},{"path":"export-and-visual.html","id":"more-ideas","chapter":"B Export and Visual","heading":"B.2.3 More ideas","text":"Check Resources section see others done method!","code":""},{"path":"probability-aggregation.html","id":"probability-aggregation","chapter":"C Probability aggregation","heading":"C Probability aggregation","text":"core GeoPressure, try estimate position bird based pressure mismatch geolocator weather reanalysis dataset ERA5. major challenge process transformation map errors (mismatch) probability.chapter, present challenge, look theory behind , explore possible solutions using Great Reed Warbler (18IC) example.","code":""},{"path":"probability-aggregation.html","id":"problem-presentation","chapter":"C Probability aggregation","heading":"C.1 Problem presentation","text":"stationary period, estimate probability position \\(\\textbf{x}\\) bird based pressure timeseries measured geolocator \\(P_{gl}[t] \\quad \\forall t \\[1,\\ldots,n]\\), , Bayesian framework can written ,\n\\[p(\\textbf{x}\\mid P_{gl}[1],\\ldots,P_{gl}[n]) \\propto p(P_{gl}[1],\\ldots,P_{gl}[n] \\mid \\textbf{x}) p(\\textbf{x}).\\]interested determining likelihood term \\(p(P_{gl} \\mid \\textbf{x})\\) represents probability observing timeseries \\(P_{gl}\\) knowing bird location \\(\\textbf{x}\\). quantify probability, look mismatch \\(P_{gl}\\) pressure timeseries ERA5 database \\(P_{ERA5}(\\textbf{x})\\) extracted location \\(\\textbf{x}\\). can reformulate likelihood probability function \\(f\\) error term \\(\\varepsilon(\\textbf{x})\\) measures distance \\(P_{gl}\\) \\(P_{ERA5}(\\textbf{x})\\)\n\\[p(P_{gl} \\mid \\textbf{x}) = f(\\varepsilon[1],\\ldots,\\varepsilon[n])\\]formulation problem helps us split problem two: first defining error term \\(\\varepsilon[t]\\) secondly defining likelihood function \\(f\\).","code":""},{"path":"probability-aggregation.html","id":"error-term","chapter":"C Probability aggregation","heading":"C.1.1 Error term","text":"cases, expect measure error term simple difference \\(P_{ERA5}(\\textbf{x})[t]-P_{gl}[t].\\) However, within ERA5 grid cell 9-30km, can expect wide range altitude bird can located. offset two timeseries might due nothing difference altitude.solve issue, remove mean pressure difference, essentially ignoring absolute value pressure (altitude) error term quantify mismatch temporal variation,\n\\[\\varepsilon[t] = \\left( P_{ERA5}(\\textbf{x})[t]-P_{gl}[t]\\right) - \\left( \\frac{1}{n}\\sum_{=1}^{n} P_{ERA5}(\\textbf{x})[]-P_{gl}[] \\right) .\\]way building error term important consequences. timeseries one datapoint always yield zero error locations, resulting equally probable map. number datapoints increases, error term become able distinguish “good” “bad” locations.","code":""},{"path":"probability-aggregation.html","id":"error-term-for-the-great-reed-warbler","chapter":"C Probability aggregation","heading":"C.1.2 Error term for the Great Reed Warbler","text":"Let’s load data filterWe using GeoPressure API geopressure_map_mismatch() function measure mismatch pressure series. API can realistically return single map per stationary period, aggregates error timeseries Mean Squared Error (MSE),\n\\[\\mathit{MSE} = \\frac{1}{n}\\sum_{t=1}^{n} \\varepsilon[t]^2.\\]MSE shows match pressure best, excluding open water (ERA5-LAND support water). tag$stap also contains column nb_sample indicates number datapoints used compute MSE \\(n\\). value can value max_sample.","code":"\nload(\"./data/interim/CB619.RData\")\nplot(tag, type = \"map_pressure_mse\")\nkable(head(tag$stap))"},{"path":"probability-aggregation.html","id":"gaussian-likelihood-function","chapter":"C Probability aggregation","heading":"C.2 Gaussian likelihood function","text":"order find appropriate likelihood function, first need assume distribution error. sources error (1) sensor measurement error, (2) ERA5 reanalysis error (3) attitudinal movement bird time. removing mean error, can ignore long-term errors (e.g., constant temporal error ERA5 biases geolocator sensor).figure shows error distribution known location equipment retrieval.Therefore, assuming Gaussian distribution error, Gaussian likelikhood multivariate normal distribution given \n\\[ f(\\boldsymbol{\\varepsilon})={\\frac {1}{(2\\pi)^{n/2} \\sqrt{\\det(\\boldsymbol{\\Sigma})}}}\\exp \\left(-\\frac{1}{2} \\boldsymbol{\\varepsilon} \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\varepsilon} \\right).\\]\nvector notation \\(\\boldsymbol{\\varepsilon }=[\\varepsilon[1],\\ldots,\\varepsilon[n]]\\) covariance matrix \\(\\boldsymbol{\\Sigma}\\) contains variance two datapoints \\(\\boldsymbol{\\Sigma}_{t_1,t_2} = \\operatorname {E}[ \\varepsilon[t_1] \\varepsilon[t_2] ]\\).","code":"\nsd <- 0.5"},{"path":"probability-aggregation.html","id":"independance-of-errors","chapter":"C Probability aggregation","heading":"C.2.1 Independance of errors","text":"covariance difficult quantify explicitly, can first look strong assumption independence error, \\(\\varepsilon_t \\overset{..d.}{\\sim} \\mathcal{N}(0,\\sigma)\\). case, Gaussian likelikhood function \\(f_{ind}\\) simply product normal probability density function error \\(\\varepsilon[t]\\),\n\\[ f_{ind}(\\boldsymbol{\\varepsilon})=\\prod _{t=1}^{n}f_\\mathcal{N}(\\varepsilon[t])=\\left({\\frac {1}{2\\pi \\sigma ^{2}}}\\right)^{n/2}\\exp \\left(-{\\frac {\\sum _{t=1}^{n}\\varepsilon[t]^2}{2\\sigma ^2}}\\right).\\]can re-write equation function MSE\n\\[ f_{ind}(\\boldsymbol{\\varepsilon})=\\left({\\frac {1}{2\\pi \\sigma ^{2}}}\\right)^{n/2}\\exp \\left(-n{\\frac {\\mathit{MSE}}{2\\sigma ^2}}\\right).\\]Using equation, can compute probability stationary periods. function corresponds one used geopressure_map_likelihood() using following parametersAssuming independence, Gaussian likelihood transforms MSE probability narrow ranges uncertainties. narrow long stationary period (#7 #9), entire map 0.comes multiplication probability assumed independence case (see equation ). underlying assuming multiplication operator conjunction probabilities, aggregating two information done operator: \\(P(~\\text{}~B) = P()\\times P(B)\\). information content overlapping every datapoint information kept.","code":"\ntag_tmp <- geopressure_map_likelihood(tag, sd = sd, log_linear_pooling_weight = \\(n) 1)\nplot(tag_tmp, type=\"map_pressure\")"},{"path":"probability-aggregation.html","id":"quantification-of-the-errors-dependance","chapter":"C Probability aggregation","heading":"C.2.2 Quantification of the errors dependance","text":"Ploting auto-covariance calibration site species allow us see temporal pattern error. bird, can see clear daily fluctuation certainly due bird daily movement commute feeding roosting site. auto-covariance approaches 0 birds, expected removed mean value. However, sill reached 6 12 hours depending bird (hoopoe doesn’t reach 3 days!).observation, one option construct covariance matrix based auto-covariance. look like cleanest way , two issues.first one absence stationarity. Indeed, auto-covariance amplitude (potentially shape) strongly influenced vertical displacement bird, strongly correlated topography. instance, Eurasian Hoopoe high variance large temporal range breeds feet Alps. rest year, lives rather flat area. Therefore, covariance built breeding site appropriate sites.second issue definition error term different duration stationary period.","code":""},{"path":"probability-aggregation.html","id":"probability-aggregation-1","chapter":"C Probability aggregation","heading":"C.3 Probability aggregation","text":"rest vignette, take different angle, re-framing problem differently exploring options compute likelihood.field probability aggregation, problem combining sources information overlapping/redundant content frame finding pooling operator \\(F\\) ,\n\\[p(\\textbf{x}\\mid \\varepsilon[1],\\ldots,\\varepsilon[n]) \\approx F(p(\\textbf{x} \\mid \\varepsilon[1]) ,\\ldots,p(\\textbf{x} \\mid \\varepsilon[n])),\\]\n, Gaussian assumption, can written,\n\\[ F(f(\\varepsilon[1]),\\ldots,f(\\varepsilon[n]))=F(\\boldsymbol{\\varepsilon})\\]","code":""},{"path":"probability-aggregation.html","id":"introduction-to-log-linear-pooling","chapter":"C Probability aggregation","heading":"C.3.1 Introduction to Log-linear pooling","text":"popular aggregation function log-linear pooling,\\[F(\\boldsymbol{\\varepsilon}) \\propto \\prod_{t=1}^n f(\\varepsilon[t])^{w_t}\\]equation also relies principle conjunction probability, uses weight \\(w_t\\) related new information brought additional \\(\\varepsilon[t]\\). Formally, can defined \n\\[w_t=\\frac{\\ln p(\\varepsilon[t] \\mid \\boldsymbol{x},\\varepsilon[1],\\ldots \\varepsilon[t-1])}{\\ln p(\\varepsilon[t] \\mid \\boldsymbol{x})}.\\]\nDenis Allard, . Comunian, Philippe Renard1 great resource learn probability aggregation log linear pooling.log-linear pooling aggregation simplifies case Gaussian independence \\(w_t=1\\). already explored case earlier.general case, using Gaussian probability density function formula, can write,\n\\[f(\\varepsilon[t])^{w_t} = \\left({\\frac {1}{2\\pi \\sigma ^{2}}}\\right)^{w_t/2}\\exp \\left(-w_t{\\frac {\\varepsilon[t]^2}{2\\sigma ^2}}\\right).\\], assume weight constant \\(w_t=w\\), can rewrite pooling aggregator \n\\[F(\\boldsymbol{\\varepsilon}) \\propto \\left({\\frac {1}{2\\pi \\sigma ^{2}}}\\right)^{\\frac{wn}{2}} \\exp \\left(-{\\frac {w}{2\\sigma ^2}}\\sum _{t=1}^{n}\\varepsilon[t]^2\\right),\\]even write function MSE,\n\\[F(\\boldsymbol{\\varepsilon}) \\propto \\left({\\frac {1}{2\\pi \\sigma ^{2}}}\\right)^{\\frac{wn}{2}} \\exp \\left(-{\\frac {wn}{2\\sigma ^2}}\\textit{MSE}\\right).\\]","code":""},{"path":"probability-aggregation.html","id":"log-linear-pooling-w1n","chapter":"C Probability aggregation","heading":"C.3.2 Log-linear pooling, \\(w=1/n\\)","text":"interesting case \\(w=1/n\\), \\(\\sum_t w_t=1\\). simplify log-linear pooling aggregator \n\\[ F(\\boldsymbol{\\varepsilon})={\\frac {1}{\\sigma\\sqrt{2\\pi} }}\\exp \\left(-{\\frac {1}{2\\sigma ^2}\\mathit{MSE}}\\right),\\]\ncan interpreted Gaussian probability distributions MSE. length timeseries \\(n\\) disappeared equation, aggregation dependence mean square errors, regardless many datapoints.can try see influence probability map.expected disappearance n, uncertainty now completely independent duration stationary period.obviously want, shows extreme log-linear pooling.","code":"\ntag_tmp <- geopressure_map_likelihood(tag, sd = sd, log_linear_pooling_weight = \\(n) 1/n)\nplot(tag_tmp, type=\"map_pressure\")"},{"path":"probability-aggregation.html","id":"log-linear-pooling-w-lognn","chapter":"C Probability aggregation","heading":"C.3.3 Log-linear pooling, \\(w = \\log(n)/n\\)","text":"study, chose use \\(w=\\frac{\\log(n)}{n}\\), result pooling aggregation\\[F(\\boldsymbol{\\varepsilon}) \\propto \\left({\\frac {1}{2\\pi \\sigma ^{2}}}\\right)^{\\frac{w\\log(n)}{2}} \\exp \\left(-{\\frac {\\log(n)}{2\\sigma ^2}}\\textit{MSE}\\right).\\]scheme designed minimize strength \\(1/n\\)","code":"\ntag_tmp <- geopressure_map_likelihood(tag, sd = sd, log_linear_pooling_weight = \\(n) log(n)/n)\nplot(tag_tmp, type=\"map_pressure\")"},{"path":"probability-aggregation.html","id":"validation","chapter":"C Probability aggregation","heading":"C.3.4 Validation","text":"Validation uncertainty estimation relatively difficult, especially datapoints assume behaviour bird might differ calibration sites (equipment retrieval) rest journey.figure , examples uncertainty estimate shown. Ideally, want colored area small (low uncertainty), assessing uncertainty, also want red cross fall within colored area. , red cross often outside, estimator confident.Furthermore, shape uncertainty can strongly anisotropic (e.g., hoopoe bottom right) making distance likely point (blue) true value (red cross) poor measure uncertainty.Assessing uncertainty relies checking red cross distributed according uncertainty shape. formal way quantifiying uncertainty quantile true value \\(q=p(\\boldsymbol{x}\\leq \\boldsymbol{x}_{true})\\), corresponds probability variable less equal true value. , true value belongs distribution, distribution quantile uniform.can visualize empirical cumulative distribution quantiles fall 1:1 line (like qq-plot). two extreme cases (\\(w=1\\) \\(w=1/n\\)) show overconfidence (line) underconfidence (line) respectively. Indeed, distribution quantile using \\(w=1/n\\) method shows lot quantile values 0.9-1, indicates true value within 90% uncertainty contour (-confident).method chosen (\\(w=\\log(n)/n\\)) better , still general underconfident. calibration validation performed rather long temporal serie (equipment retrieval), one can expect labelisation pressure better/easier places. Thus, seems appropriate slightly underconfident method developed.covariance aggregation scheme implemented computing covariance matrix multi-variate Gaussian distribution. covariance function build using exact variogram species. , theory, correct method, looks overconfident. Thus didn’t use now.Looking forward, calibration highly dependent local topography ability bird move . Manual edition/labelling also strong impact.","code":""}]
