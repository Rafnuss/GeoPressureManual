<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Trajectory | A User Manual for GeoPressureR</title>
<meta name="author" content="Raphaël Nussbaumer">
<meta name="description" content="In this last chapter of the basic tutorial, we model the full trajectory of the Swainson’s Warbler by combining the observation model of pressure with a movement model of flight accounting for...">
<meta name="generator" content="bookdown 0.36 with bs4_book()">
<meta property="og:title" content="Chapter 3 Trajectory | A User Manual for GeoPressureR">
<meta property="og:type" content="book">
<meta property="og:url" content="https://raphaelnussbaumer.com/GeoPressureManual/trajectory.html">
<meta property="og:image" content="https://raphaelnussbaumer.com/GeoPressureManual/assets/cover.png">
<meta property="og:description" content="In this last chapter of the basic tutorial, we model the full trajectory of the Swainson’s Warbler by combining the observation model of pressure with a movement model of flight accounting for...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 Trajectory | A User Manual for GeoPressureR">
<meta name="twitter:description" content="In this last chapter of the basic tutorial, we model the full trajectory of the Swainson’s Warbler by combining the observation model of pressure with a movement model of flight accounting for...">
<meta name="twitter:image" content="https://raphaelnussbaumer.com/GeoPressureManual/assets/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="libs/plotly-binding-4.10.2/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.2.0/leaflet.js"></script><script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script><script src="libs/leaflet-providers-plugin-2.2.0/leaflet-providers-plugin.js"></script><link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/Rafnuss/GeoPressureManual/main/assets/geopressuremanual.ico">
<!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-NJ17NCTPB5"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-NJ17NCTPB5');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A User Manual for GeoPressureR</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li class="book-part">Basic tutorial</li>
<li><a class="" href="tag-object.html"><span class="header-section-number">1</span> Tag object</a></li>
<li><a class="" href="pressure-map.html"><span class="header-section-number">2</span> Pressure map</a></li>
<li><a class="active" href="trajectory.html"><span class="header-section-number">3</span> Trajectory</a></li>
<li class="book-part">Advanced tutorial</li>
<li><a class="" href="light-map.html"><span class="header-section-number">4</span> Light map</a></li>
<li><a class="" href="trajectory-with-wind.html"><span class="header-section-number">5</span> Trajectory with wind</a></li>
<li class="book-part">Labelling tools</li>
<li><a class="" href="pressurepath.html"><span class="header-section-number">6</span> Pressurepath</a></li>
<li><a class="" href="geopressureviz.html"><span class="header-section-number">7</span> GeoPressureViz</a></li>
<li><a class="" href="labelling-tracks.html"><span class="header-section-number">8</span> Labelling tracks</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="resources.html"><span class="header-section-number">A</span> Resources</a></li>
<li><a class="" href="export-and-visual.html"><span class="header-section-number">B</span> Export and Visual</a></li>
<li><a class="" href="probability-aggregation.html"><span class="header-section-number">C</span> Probability aggregation</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/Rafnuss/GeoPressureManual/">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="trajectory" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Trajectory<a class="anchor" aria-label="anchor" href="#trajectory"><i class="fas fa-link"></i></a>
</h1>
<p>In this last chapter of the basic tutorial, we model the full trajectory of the Swainson’s Warbler by combining the observation model of pressure with a movement model of flight accounting for likely speed to constrain possible distances between stationary periods. To do so, we use a highly optimized <a href="https://en.wikipedia.org/wiki/Hidden_Markov_model" target="_blank">Hidden Markov model</a> presented in Nussbaumer et al. (<a href="https://doi.org/10.1111/2041-210X.14082" target="_blank">2023b</a>).</p>
<p>This involves three main steps:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Create the graph</strong> representing the possible trajectory of the bird.</li>
<li>Set the <strong>movement model</strong> which defines the likelihood of each possible flight encoded in the graph.</li>
<li>
<strong>Compute three products</strong> of the model: (1) the most likely trajectory, (2) the probability maps at each stationary period (i.e., marginals), and (3) simulated paths sampled according to their likelihood.</li>
</ol>
<div id="background-on-movement-modeling" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Background on movement modeling<a class="anchor" aria-label="anchor" href="#background-on-movement-modeling"><i class="fas fa-link"></i></a>
</h2>
<p>If you haven’t heard of <a href="https://en.wikipedia.org/wiki/Hidden_Markov_model" target="_blank">Hidden Markov model</a>, <a href="https://doi.org/10.1016/j.tree.2007.10.009" target="_blank">state-space models</a>, or <a href="https://en.wikipedia.org/wiki/Trellis_(graph)" target="_blank">trellis graphs</a>, I recommend that you start by reading the summary below, or - even better - read Patterson et al. (<a href="https://doi.org/10.1016/j.tree.2007.10.009">2008</a>) and Nussbaumer et al. (<a href="https://doi.org/10.1111/2041-210X.14082" target="_blank">2023b</a>) if you’re feeling brave!</p>
<details><summary>
Click here to read a short summary of movement model
</summary><div class="alert alert-info" role="alert">
<p>We start by making the fundamental assumption that the overall trajectory can be separated into <strong>discrete</strong> positions which, together, create a trajectory.</p>
<p>This discretization allows us to use a <a href="https://en.wikipedia.org/wiki/Hidden_Markov_model" target="_blank">Hidden Markov model</a>, which conveniently distinguishes the <strong>unknown positions</strong> of a bird <span class="math inline">\(X_t\)</span> from <strong>known observations</strong> <span class="math inline">\(Y_t\)</span> which can be related to these positions (e.g., pressure or light measurement). Defining an HMM requires that we can compute:</p>
<ol style="list-style-type: decimal">
<li>An <strong>observation model</strong> <span class="math inline">\(P(Y_t | X_t)\)</span>, which defines the likelihood of observing a measurement conditional to a known position. This is exactly what our pressure likelihood map computed in the previous chapter does.</li>
<li>A <strong>movement model</strong> <span class="math inline">\(P(X_t+1|X_t)\)</span>, defining the probability that a bird was able to fly a specific distance between two consecutive stationary periods.</li>
<li>An <strong>initial state</strong> <span class="math inline">\(P(X_0)\)</span>, technically required but this does not constitute a strong constraint in our case.</li>
</ol>
<p>Let’s say that our goal is to produce the probability map for each stationary period accounting for all pressure measurements while maintaining likely flights. This corresponds to the <strong>marginal</strong> probability map <span class="math inline">\(P(X_t=x_t|Y_0=y_0,...Y_t=y_t)\)</span>. If you are not familiar with the lower and capital case, <span class="math inline">\(X_t\)</span> represents the random variable (i.e., the position of the bird at a stationary period <span class="math inline">\(t\)</span>), while <span class="math inline">\(x_t\)</span> is a specific value that <span class="math inline">\(X\)</span> can take, that is, the specific coordinates of pixels on the map.</p>
<p>Because the number of possible positions is limited (i.e., number of pixels on the map), we can solve the HMM exactly. This is in contrast to Markov Chain Monte Carlo (MCMC) algorithm, which does not assume any discretization of space but relies on an iterative approach to solve the model.</p>
<p>A graph is a convenient mathematical representation of a model which has states (nodes) and relations between these states (edges). Graphs are a general and fundamental mathematical tool, but here we use a specific graph structure corresponding to the HMM presented above: two states <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> for each time step <span class="math inline">\(t\)</span> (nodes), and an observation and movement model (relating <span class="math inline">\(X_t\)</span> to <span class="math inline">\(X_t+1\)</span> and <span class="math inline">\(Y_t\)</span> to <span class="math inline">\(X_t\)</span> respectively). All other relationships are assumed to be independent.</p>
<p>Typically in animal movement, the graph is only used to represent the random variable of the HMM, but in our case, we also use the concept of graph to store all discrete positions (i.e., pixels) of the bird at all timesteps, referred to as a <a href="https://en.wikipedia.org/wiki/Trellis_(graph)" target="_blank">trellis graphs</a>.</p>
<p>You can think of the nodes as a full 3D grid of lat x lon x stationary period and the edges as all possible pairs of nodes between two consecutive stationary periods. As you can imagine, this results in a very high number of edges! The novelty of Nussbaumer et al. (<a href="https://doi.org/10.1111/2041-210X.14082" target="_blank">2023b</a>) is to construct this graph using only the useful nodes and edges, thereby dramatically reducing the computational resources required.</p>
</div>
</details>
</div>
<div id="create-the-graph" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Create the graph<a class="anchor" aria-label="anchor" href="#create-the-graph"><i class="fas fa-link"></i></a>
</h2>
<p>We create the trellis graph with the function <code><a href="https://raphaelnussbaumer.com/GeoPressureR/reference/graph_create.html">graph_create()</a></code>, which performs the following steps:</p>
<ol style="list-style-type: decimal">
<li>Keep only the nodes of all locations within a threshold percentile of the likelihood map <code>thr_likelihood</code>.</li>
<li>Keep only the nodes which are within reach of at least one node of the previous and one of the next stationary period. This is done by assuming a maximal possible groundspeed <code>thr_gs</code>. This key step is efficiently computed with the image binary distance function <code><a href="https://rdrr.io/pkg/EBImage/man/distmap.html">EBImage::distmap()</a></code>.</li>
<li>Build the edges based on the filtered nodes and the groundspeed threshold <code>thr_gs</code>.</li>
<li>Prune the graph based on the flow graph constraint, that is, that all nodes must be connected to the equipment node(s) and retrieval node(s), to avoid dead branches (where some nodes are connected in a single direction).</li>
</ol>
<p>These steps are explained and illustrated in more detail in <a href="https://besjournals.onlinelibrary.wiley.com/doi/10.1111/2041-210X.14082#mee314082-sec-0004-title">section 2.2 of Nussbaumer et al. (2023b)</a></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://raphaelnussbaumer.com/GeoPressureR/reference/graph_create.html">graph_create</a></span><span class="op">(</span><span class="va">tag</span>,</span>
<span>  thr_likelihood <span class="op">=</span> <span class="fl">0.90</span>, <span class="co"># percentile express</span></span>
<span>  thr_gs <span class="op">=</span> <span class="fl">100</span> <span class="co"># km/h</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="set-movement-model" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Set movement model<a class="anchor" aria-label="anchor" href="#set-movement-model"><i class="fas fa-link"></i></a>
</h2>
<p>We then define the movement model by setting a parametric function converting groundspeed to probability.</p>
<p>In this basic tutorial, we use the gamma distribution to model the probability of groundspeed.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://raphaelnussbaumer.com/GeoPressureR/reference/graph_set_movement.html">graph_set_movement</a></span><span class="op">(</span><span class="va">graph</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"gamma"</span>,</span>
<span>  shape <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  scale <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  low_speed_fix <span class="op">=</span> <span class="fl">15</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Because birds may fly back and forth over small distances, we give all groundspeeds under 15km/h the same probability as for 15 km/h <code>low_speed_fix</code>.</p>
<p>We can check the parametric function created with</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://raphaelnussbaumer.com/GeoPressureR/reference/plot_graph_movement.html">plot_graph_movement</a></span><span class="op">(</span><span class="va">graph</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-12-1.png" width="672"></div>
</div>
<div id="products" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Products<a class="anchor" aria-label="anchor" href="#products"><i class="fas fa-link"></i></a>
</h2>
<p>With the graph built, we can create three products which are presented in more detail in <a href="https://besjournals.onlinelibrary.wiley.com/doi/10.1111/2041-210X.14082#mee314082-sec-0010-title">section 2.3 of Nussbaumer et al. (2023b)</a>.</p>
<div id="product-1-most-likely-path" class="section level3" number="3.4.1">
<h3>
<span class="header-section-number">3.4.1</span> Product 1: Most likely path<a class="anchor" aria-label="anchor" href="#product-1-most-likely-path"><i class="fas fa-link"></i></a>
</h3>
<p>The graph can directly and efficiently compute the most likely path, that is, the set of positions for each stationary period which maximizes the joint probability of the trajectory. It finds the optimal compromise between the most likely position according to the pressure (and light) likelihood map and the realistic flight distance defined by the movement model.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_most_likely</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://raphaelnussbaumer.com/GeoPressureR/reference/graph_most_likely.html">graph_most_likely</a></span><span class="op">(</span><span class="va">graph</span><span class="op">)</span></span></code></pre></div>
<p>In GeoPressureR, we store <code>path</code> as data.frame of the position (and other information taken from <code>graph$stap</code> for each stationary period). A path can be displayed on the map with <code><a href="https://raphaelnussbaumer.com/GeoPressureR/reference/plot_path.html">plot_path()</a></code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">path_most_likely</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="8%">
<col width="3%">
<col width="5%">
<col width="9%">
<col width="10%">
<col width="20%">
<col width="20%">
<col width="8%">
<col width="10%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="right">stap_id</th>
<th align="right">j</th>
<th align="right">ind</th>
<th align="right">lat</th>
<th align="right">lon</th>
<th align="left">start</th>
<th align="left">end</th>
<th align="left">include</th>
<th align="right">nb_sample</th>
<th align="left">known</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2806</td>
<td align="right">37.28681</td>
<td align="right">-82.30497</td>
<td align="left">2021-07-01 02:15:10</td>
<td align="left">2021-09-24 00:15:10</td>
<td align="left">TRUE</td>
<td align="right">0</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">3056</td>
<td align="right">32.25000</td>
<td align="right">-80.75000</td>
<td align="left">2021-09-24 11:15:10</td>
<td align="left">2021-09-24 23:45:10</td>
<td align="left">TRUE</td>
<td align="right">13</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">1</td>
<td align="right">3066</td>
<td align="right">27.25000</td>
<td align="right">-80.75000</td>
<td align="left">2021-09-25 10:45:10</td>
<td align="left">2021-09-25 23:45:10</td>
<td align="left">TRUE</td>
<td align="right">14</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">2515</td>
<td align="right">22.75000</td>
<td align="right">-84.25000</td>
<td align="left">2021-09-26 12:45:10</td>
<td align="left">2021-09-27 04:15:10</td>
<td align="left">TRUE</td>
<td align="right">16</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">1</td>
<td align="right">2835</td>
<td align="right">22.75000</td>
<td align="right">-82.25000</td>
<td align="left">2021-09-27 08:15:10</td>
<td align="left">2022-04-06 00:45:10</td>
<td align="left">TRUE</td>
<td align="right">100</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">1</td>
<td align="right">2744</td>
<td align="right">28.25000</td>
<td align="right">-82.75000</td>
<td align="left">2022-04-06 10:15:10</td>
<td align="left">2022-04-07 00:15:10</td>
<td align="left">TRUE</td>
<td align="right">14</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://raphaelnussbaumer.com/GeoPressureR/reference/plot_path.html">plot_path</a></span><span class="op">(</span><span class="va">path_most_likely</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-d1543014ea951377afcf" style="width:100%;height:480px;" class="leaflet html-widget "></div>
<script type="application/json" data-for="htmlwidget-d1543014ea951377afcf">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["Esri.WorldTopoMap",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolylines","args":[[[[{"lng":[-82.30497200000001,-80.75,-80.75,-84.25,-82.25,-82.75,-82.25,-82.75,-81.75],"lat":[37.286812,32.25,27.25,22.75,22.75,28.25,30.75,35.75,37.25]}]]],null,[1,1,1,1,1,1,1,1,1],{"interactive":true,"className":"","stroke":true,"color":"black","weight":5,"opacity":0.7,"fill":false,"fillColor":"black","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[[37.286812,32.25,27.25,22.75,22.75,28.25,30.75,35.75,37.25],[-82.30497200000001,-80.75,-80.75,-84.25,-82.25,-82.75,-82.25,-82.75,-81.75],[18.21375476728228,5.097132734541368,5.14735685560886,5.378750066974563,22.29624904030032,5.243610795028083,9.700841347437279,5.289814473047844,16.53865060807308],null,[1,1,1,1,1,1,1,1,1],{"interactive":true,"className":"","stroke":true,"color":"white","weight":2,"opacity":1,"fill":true,"fillColor":"grey","fillOpacity":0.8},null,null,null,null,["#1, 84.9 days","#2, 0.5 days","#3, 0.5 days","#4, 0.6 days","#5, 190.7 days","#6, 0.6 days","#7, 6.8 days","#8, 0.6 days","#9, 57.7 days"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[22.75,37.286812],"lng":[-84.25,-80.75]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="product-2-marginal-probability-map" class="section level3" number="3.4.2">
<h3>
<span class="header-section-number">3.4.2</span> Product 2: Marginal probability map<a class="anchor" aria-label="anchor" href="#product-2-marginal-probability-map"><i class="fas fa-link"></i></a>
</h3>
<p>Estimating the uncertainty of the bird’s position for each stationary period is generally the most sought-after output of tracking studies. While the pressure map provides some information for each stationary period, we can now produce the probability map of positions accounting for all observations and transitions. In the HMM, these maps correspond to the marginal distribution of a Markov process.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marginal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://raphaelnussbaumer.com/GeoPressureR/reference/graph_marginal.html">graph_marginal</a></span><span class="op">(</span><span class="va">graph</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
ℹ Compute movement model

✔ Compute movement model [20ms]
## 
ℹ Compute marginal

                   
✔ All done
## ℹ Compute marginal

✔ Compute marginal [67ms]</code></pre>
<p>You can visualize the marginal map along with the most likely path:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">marginal</span>, path <span class="op">=</span> <span class="va">path_most_likely</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-b3871908bb4bbe435f5e" style="width:100%;height:480px;" class="leaflet html-widget "></div>
<script type="application/json" data-for="htmlwidget-b3871908bb4bbe435f5e">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["Esri.WorldTopoMap",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAABTCAYAAAAsnA/DAAACV0lEQVR4nO1ay23DMAylgx58CTpB1+sOnsA7dL1OUPjim3sS4LqSTEr8KdIDgiKAK/LpkSLFeHrO6wGNY9uXifL8Q8oRz3izdqAGVIUDulR6kG4JpaEN4IT098+Xqj0XpD/eP1XtuSCtjUG6F3RJurmOrKZUBTSlNAdhgMZIc8F9eHOpe4ZrpSUIAzgnLQWX4S2lcIA7paUJAzgjrUEYwBlpLXRJeuIeAedCFGNLI8RJpINDd/+DdTy2jhvSko5YEM/Waa3TVBvJg+xVCQN0enpHSVurLP2jornSdxv8nNcjfLhsJk9vbbWvfkjaN1faAm5yGmOTK8Rd3adTxAPZMRisQBOkudOtCdIA/4nX5LdJTmMd3vZlSuXz+ftzXg9KNJgrjb1/pzbqTBi7mdHmRKpknW3lVKxtmO6UZydNWe+uFFHXwvrN1oZyTVOoa5esm52c1Ix9ah2j2MmlSgzip7ck4djamOeypKmlQBIc6RHWKBoMlkxQa5ESoKRJQYW39evRwX7pxeNcx7d9mdiH/TFjHLjWeMyzqeeaIc2Jh1fHJPGnaedc2PNmoto/akOPgeWmkA2/AnGRfhgLK9LF92nPOXuHqiFCq8RZnaaGfHM5jQX3XbjUh7Mt8xkZN64/+MX+ipPWDOFcfx6+b/symTiUcoxr3bB2ymazpGv6BNOctrqnq5H2VNPVHcGOnCUvPa5fqEkdRrVwE3IA6ZLDTdxNc6J5qLlS+g5cG+NGaU0M0r1gkO4Fg3QvcF+nJZqWobQ3SLWmXSrNQlpCEckLCJvS1q9oUPALo5VzsNDDfb8AAAAASUVORK5CYII=",[[40,-99.99999999999999],[0,-68]],0.8,null,null,"#1 | 01 Jul 02:15 - 24 Sep 00:15"]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAABTCAYAAAAsnA/DAAAFP0lEQVR4nO2aTYgcRRTHf1Xd0z0zu+Mmm12RfGgSNCAEPETcgycJShARLwExEtGDB8GIEpAFL4IYEBQ8CXtQEBEhR0EjojcvhuAhQkw0JmD8ILuEJJOd7enervKw28u4uz3TPV093ePOH4b56n71/vV/r96rmhGN6inNEMHWAg1ETmuhue3NilQ2zLuVD8ZVhWWhUOhV0ivP6FR8gSEifUcGNJSDRhMKhQIW2m+mZwxIw74NBYZGaQAXixCF0BCK/peioSG9MxxDAKEQSARX26/3FdpQ8vCeUtW11zUq1KlQ0zZVbWWyW2qlF6S39npSOyg0PgpPZNNqIEof8fdkuv+wv4uz9nW2KYdxXaGWUelSh3deGEh4n3H+2PDZtKoxL5d63vtM+z7GteRFbx8tNLekJCRbE1lITh/2d/Gd82eia++3BHUnRAA3PAutLNoym9uFkE5C+G17D9OTLdzKDYTQBMs27s067948LlDZxjdCemc4xl/WoglTfLa/xvO/L/HIoV+pVtsgNWrZIgwlz33/Tt+1uROZSe9YraX7wru4Yt3O7NDDj53j8pM+Qq7KqQVhYOE165ltR8hMWgMKTbgu5o56ezldvZrIxvz73yBrATteeYp7njgPlkYvVhBSYx09Z0TdToi89tNHvb1sF4I598raZz8cuc6jZ+7e9Pr5Cx+DBOUKQkcgQxibvmicMGzROp0b6dPVq7TXxVCcygDTD75EOCbxtwc0Ji+KvFSGjDntaklbbF4/Hvd343dpIi69/DMH5g6y8MEZrAkPMebDZc3YzJXcyEboW+norCoO3zrXaMZMyNczHgfmDnL+2G9MvXGEhbP7ufnjPqyZS7kThowLWUVLLAS2lthIXCxq2qaubbZphwlVoaEtJoVgdyNgYrzNqzfm+eTeBq7jU636CKlx3Tb1RotDX703ENKZwjsQCqklGo1afYQoQjS+ULSFwkZwR1vcatncXrJ5y65x7W9NxQ6xbYUQ4Ngh9VrbFKeeMFayJpSDi81l/7VYtU6KL7QNWAKkAF+BABwJrqVwbc3J1rHc1U5Furl6vhx3z5Sq4mqLX4ITiRw/Lj7XCrBYWSMcBB/xbDlIN1MepqfB0/LTtfEVGgF8qV7IlXjXnM6TbIRbcqWw/WTP89DyFALIuovqhVjSgyAMsCgClqMxRTCIIUdt6BoGpTLAIgFLrCjcIqBFwAPOh7n+qFj4EfCF4MTaYvqP1drwfedCa0qM2NV7kGrDxjKY5/ijnI4waJWTjmmqeyw8pzsRRzwia0qMUXiXFabTbShIw0biWfK7kJxO6nDTmxVx+dz5vlE9pdNEQ+FKd3O2c3LiJqqTcNLJ3LQ5yatkre+u4lTM2jD1Ut446TT2epWitLaS+m2sDe0VWqYnMovdricnacKp2/em0qWbQGkamNxX7zwJb2Y7yXVdSactBXnCRHpENvo6GOznBDUr4gTop0lJFN5F/z06Gr/fjUdnHW96syK336c7BzOBNCcovSZnaEibhCyrY3niP027ScNlnsxE7V/ahj4JipyU1AP/H4jn0g8nRVGk+95PlzlneyHTIcKwEjfqdNqQH7qcTgrTe+F+fegcq/AzMtNoVE/p6BG9X/+cO+lBhnC3/jx63/RmRSEOxTlmym5kO27MoSWdpU8oNKeL2qcPjHSZavrAHUl65JznpqfQ2U9ydJxHCpQm5CC+5JgmXprmZJCLWqmU7gVTE1MapQeJEemtghHprYIR6a2C0tfpPJqWkdJlQ16t6ZZU2gjpPBTJcwNiTOmi/6KRBv8CYLBtdxb22KgAAAAASUVORK5CYII=",[[40,-99.99999999999999],[0,-68]],0.8,null,null,"#2 | 24 Sep 11:15 - 24 Sep 23:45"]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAABTCAYAAAAsnA/DAAAFz0lEQVR4nO2aT2gcVRzHP+/N393tptuENjG1aiwG8aAHsYciFHsuCp5qhSr0YBGKoiCtKFo9bKqI9uJJD4JYj61Ij0IvVoKCelAqolK1rf2Tpoltdndm5+chO0m62U1md2d2dk2+MCyz+/a93/d9f+/3fu83o/JuUehzzJaOqFba66QM6WWYaRvQCVpVOMSaVHqddD+hXdeGPibdCdZJJwVT2vbERLCudFLw1fKkbyCwuzF0Q6SidCFwmNGVNIYGUsrIpnW57f92slWFiE3pboSqOAhDTErXW2KJxlNBHF0DMFrNEgCzMfXXMemQsBKF1AKWhSYTmB2t2/FqAUMUk/5Bda5TI+vQkXsvJRwsidC3lI+FZqSava39g/5QpH53eMNsDlwm/YOJrJo1uU+37d6hBFoUCqhfwbZobAzGqwV+MaYB+NG8tqyfHd4wk9Y/7PRGMNDYojgZ7E80LrattGKRcH3yMRJkMZknHRKux67KKAAZMdhd2UpWTAYDK3HC0AZpFV41wkZd7N4SZDFFY2FgieZhf8uyPnZXtnLGvsCe8l2csS+wQQxyYvCp7OtKkt6We4eENQqNYkNgYaCx0Jii5lUWjYOBIYpHvTvIiIErGo3Cqy2GnGj2l8awgYwGulSibJl0SFjVCBuiMVCYKCxR2GgcMchgkhMTSzQZ0eTEwFOCArJisK80xpCGjCE4ZsDQxhJcip9gI0QmvdSl5xVeVNpE44jGxeIH7/mmLvq6/lxMJWgFlhGQz3rkc2UGNswxMnqZ6YOPS+HNLxJ38UikQytulA8rgCHnmGgUWlRNZY2DSVZM9uhP5MvgmYaGv13du/i9B6fvf1cGBv5l4+AMhZEpsndOdconElSUYn9cOW8jXHv1STHdCoZdxd02hRqbxth5LlG1V1Q6SbIhcqPXUWYVNKhtM5TvST6aNd2yukEYQNlVpKrRtofkfSpDXuJjrsk0tCHpbqkMEJRNgrKJfyOLvmrjXjS5dWk8UR9P/VlW5tBXavqNJwQlmBfzWJVbKMdf+N0/8Yh4V/OUrgyw6a2TsYjRNHp3U22APw4cECdbwnQ9rGyZwtFTiY2futIhfv9pDK0DRBTZ3BxwKrGxUl/TIR47+5r69vvtnP1uO19/80DDNhPuZ7Gs9Z5RGuDlm0/PT3ZdsfSoeUI8URwu7Y1FjJ4i3QznfajGWGjsi336Y55Sl2N8ONAXpAFOV5+9zbXvtT9oe32n4t67zI9EAJ8AH6GiAnyq+AT8bdxcaDdbOqIesj4UYNmR9bfKiwv3g86ETNVOgFGQitI3lVe7fCb959QcFUqqSkUFbA4yDAfzpeNx67iU8JjD4z77eENlB51jC4QHIr4e1jA5SWrLyrtF2VrNoVD87B1Sebcow0GWXysv3Dbe3fb7olisHk3pEoXA4c/KS5HsyrtFWYlD7KSHnGNSUQEbAguNQqH4q4mxebcomwKH801+H7XfExBm9fzJyxWDK+VXGrYdcIsyE9Hu2NLQjc6EBHWlYKdWCJxT1Y4mcovzjghQUlUADFEIEChpq98VKydRO1ypD1MU11sIMiuh4ExIOFD43EyYtzO0IYrNiUZvBYkSbuTOUZbriqRXCwirIc5D8XQHk1fvBW0VBlt5cziunaCZAO28xRzJvdN+PXrALYqwXLGoCNuHExdJ6XYR536/1M7V+l1tcvqGdJzQvWpYklggHLfivTyZTdPDpfdLA0FcA6c5KS0P/H8g3vGG3wnSIt32ebqX1+xq6KiI0K/EYzW6VZfvuzUdFXEcXeOwYelYfVMNjYq8W5TwCu/rPxMn3U0XXik/D+9nS0dUKgY1MyyufsO+m43Zt6Q7yRNSXdNpndO7RrqX9vSuGxK15JzkoSfV2V+NQLNg1Cl6xuWg+ZYTN/GeSU66GdR6SunVENfE9IzS3cQ66bWCddJrBeuk1wp6fp9OImlZV7rXkFRquiaVjoV0EookeQCJTem0X9FoBf8BO49jb724tBkAAAAASUVORK5CYII=",[[40,-99.99999999999999],[0,-68]],0.8,null,null,"#3 | 25 Sep 10:45 - 25 Sep 23:45"]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAABTCAYAAAAsnA/DAAAEB0lEQVR4nO2aPWgUQRiG37n/5LLmB8EEFQwSbLSx0SaVCmnVFBFBi0BACDYieikkWHgJ+NNYxsYmtiIEm2BhoYIGRSEEMZGgxqj5Pc9csrf72bjxLtm7272d2Z3N3gshLLmb+Z55v5n5ZrJMSaQJPlcml2J2Ph8SFYjMingdgBPZddhQIJ2uQftJ1aY24GNoJ6pBB0U16KAokNC+q8icbFWGfOU0D2DAZ9C8JH1683K3UFI7LQIYkBxalKRMb1EOG5LOadHAgGTQbgADkkG7pUBCM95XwOVS1EpfbqS4LWgjoErfsRq4WTvSQIsMxAvwsvu0W6up2yq5kO1UYCCgq7cptNcui/6noue1dyaXYm2x26QzggYdBKCQeNe/ASDwM6Pk6u22252REcoyFRvQoELHlHpZWP+eO23oBBrwRSX8YTr+MA1TAvuSZk4P5ntY99FZnD64hFNN5lN6X+wul7kujdMA0DVxzXSw+zBKcyEVTzYucDFDKuhSOpTUEcvGuLXni336SvY8awnza88X0ABwU+spSu29sTtVz29P0ntttoPi0xGsvd4PXY0g0bqMcPsS9Pkkmi+e3fxcJpdizzsHaf77bnR/7C+C/rpxZfNZSaTJzuLridPRl43IvmjH8vQeKKkxtvFLAf2sh56N48fQOD71vwUAvDo5QAu/mrGSqcON8CNTZxvjQ2T1yGvIVaeVRJqWRh5DX4lCSY2xhYEz9Hu4i5JXnxa5pD48Tu/OKfg82Y7F5QZ8W6jHN82cZ2X9+uZ3C+HLOW9akTnZp5VEmhiAKIWgUAytehIv832m7eXfdNDvw3k0xWdM/z5+7BZ9mNyPmdUoHiRm0KE1YUK9ZPpZOynOrQwtbIcBCBFDgiJoohjaKIln+d6qB7IXozQXXsfz6BwAoI7CyIOgMr0qg8renDi59mEAIhRCHUWKFh0nOhC7RzloUJkGDQSd0eZBxIjBSszC5jQB0EDcgI9E79MC1pEvAF41AbQyXctC290Ktkpn/I7F79V+R+sM8B++qovBam5QnaolPkyL69tr82ouHCylt9evRzfGhyjP9G2OWdXWrYz7Zb9ZZzxUGGeldisNjm+geSoka2AiVVS082xY5sEsWdIVPtst6K3Iy0Gx3fFOAHe84TuRV9BVn6dlnrOV5OgSwa/gXIO2m/K+m9NWxePoyiOGwr58cxtqVUoiTcaP8bz1t3BoN1O4XH1uPGdyKeZJQKUC49Wu0XapPn0L7aRO8HROe3VOdw1apj3d9UCsXjmLPPRI/UJNqcXIqaRJOaD0lsMbXJrixM1FTSqnK4nXwEjjtJuqQQdFNeigqAYdFEm/T4soWmpOyyZRpWkgneYCLcIRkQcQbk57/YqGHf0FWPXuFmlylmQAAAAASUVORK5CYII=",[[40,-99.99999999999999],[0,-68]],0.8,null,null,"#4 | 26 Sep 12:45 - 27 Sep 04:15"]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAABTCAYAAAAsnA/DAAADHklEQVR4nO2az2sTQRTHv7NRTJEE8Qca6lEhXjz5N0gP9R/oTfBsES/mL8i9glepeBDEu9eevRmoUiwFrQj1F2mUpEnteFrYJLuTmZ03O2+6+4VSKNt57zPvzcybtysa9a5E4BqMOsLk+ciVI5x1xrcDNjKNcKxSRrqCDkl5UxsIGNpGFXRZVEGXRaWEDq4iszmqYgUVaQpgIDBoKrFPb6roJsU60i6AAebQrsQyvV1FOBa7SLsGBphBFwEMMIMuSqWEFtQtYFWK6tgqIsWNoGOHFv2PruNp47CBdumID3DlOV3Ublq0Mjey0woMlHT3ToX2HWXXLxW9R3rRBDfqXRn/UNnM3L2LjvasHy7te4+0D7FZ0zo2qVKc1X06CzyGrRqDFgoCmnq5BQENzIPbrG8va/rZpU159fIhbt3eQau9j+bKNgZ3xmhuncfR9jV8eXcTO70bWH3/WKxGm3IQTbB1/GAKOjkJjXpXmmSDF+jPv87hoH8F+98uYP31U9HrPZIXl39gd6+Fw99NfNpdxofvS7gXvZD9aIy+GKN9dkN+nDycA0sC68KnFieujqxGvSvvjq9jSdbwUq6JdbySrfoJnozWpuyt1J7LY0j8jI4wxAQTcYKDaGh0T1c9Sx5p1SQORh3xJvH3IST+TOa3lbf/7gsAaEcb8mvt79TYqmMtaUflI1kZStVNMR07z7jKzolN28fWMRM7g1FHmBQwzjcyl8BpY+s8p4Q2PQpcimJ5xGPkagzm6aDaKisAeYoUrfT2/Xl0bD/vxWP2HCdv9qcZo1DST51ui+q5YKApFXF1zKWminbKgTlPprJTEUv3HZaJfE6KseHTAO6kHtaVL+jcnRPOa3aRrNpFoYKTOm2a8sGtaV1R34Xz+pC0FUw3VFezL/zSfjuHLjKFVfV5spXkxaEsx6jGjcfOshkstE2d4HVN+7qnFwbN6Uwv3BHdlrPLSw/rD2qyNiNbsUk5IPvIoQZnU5wUuamxivQiUU0Mm0gXqQq6LKqgy6IKuixif067KFqqSHOTq9K0lJEmgXYREZcXELJI+/5Ew0T/AcY0rTcrs6oXAAAAAElFTkSuQmCC",[[40,-99.99999999999999],[0,-68]],0.8,null,null,"#5 | 27 Sep 08:15 - 06 Apr 00:45"]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAABTCAYAAAAsnA/DAAADf0lEQVR4nO1av2/TQBT+znZStyKi4cfAAEMrVpj5TyoWNgZAzOQv6AZigIWpUgcEG0v/BVakTkhULEAKQv3hpomb+I6FQ6bEzp19z3fG/qQosnK5e99979179xLWCzcFao5oMmA64z0qQ1xGYNuAMtBVWKKRSrek64Sirg3UmHQZtKSbgpZ0U9BI0rWryMqkKolaKW2CMFAz0qbgvHubUjcNp5WmIAw4TpoKTro3lcISzilNTRhwjHQVhIEK3JsBCISHvgjRE12sCB8eGGIkOGYxYsbBIRDAQ0RtzG+QkmYAfMHQFR6u8BDX+DIu8Q5CMMQQGPpnOGFTxOAIwLBHaUzaLtMt4DwXfYzX4vpKgqurYwgAh1GIk4mP04SBC+DGaoyHB/fIXVyLtCS06Duqsfnx7gMxPQsQj5fAEx+d7hluv3vqBmnKA2a6dUfwcQc87mD0tY/jYR9rW69IiefGdBWn6WhjiKXvAZb2Aoy+9TEeLVMvmZ2yqkofXtwFmwHipAOReDj6eZF+TfIVHMRc0lWpDADeyzXM3q5jf+cWPn9Yx4/9y3jW2yb9UdF67X3hyQ57s/5CjCddfBr2ECXAAeN/Pr/ZeS6G/ikAc2Jknt5Vqg0AG2xbHHpTjFmCGBzvZ/fJ1reutMRucIgZOKaMIwHtT+bWY1pid/qIffFHOGAxjlg8d4yp6tEZpYHszZZk28ZgCdSCtOlwqwVp4F/iZeLbSkyrGhxNBiwrntPPvXBT6HiDdaXzjE1vTtZGpQmrbubc4oQqZaXXylOxbMG0SHnjpHXmW5SKdOdStdtYGWqqm6I7d5F5czsnOu6U97mpcMkTSKeAIT+9KQnPm1tlXC5p3VRACRPhIeco1Bgs0kEtiywBihQpSu5t++/Rcv2iF490Ho8mA2a82T9vMRM4n+NVxmaNqw1pk/BcNYwSfxXtJid2eTOVyj/dgl4FNjdFe+H/gThJPawKW6QL36ddjtlFKNVEqCtxo0brunztYloVpu/CRW1Ir2W9R2YavXBTyJd8Pv9OTrpKF86rz+VzNBkwKwZlGWZqXjl31pq1JV2mTrAa07bu6ZWRdimnV26IasuZ8tJjdfdVWscUIeCMywHZKcc0cWeKkyoPNaeUXgRTG+OM0lWiJd0UtKSbgpZ0U+B8nqYoWlqlXQNVadpIpY2QplCE8gJiTGnbf9HQwS/mU9ykEvTSDgAAAABJRU5ErkJggg==",[[40,-99.99999999999999],[0,-68]],0.8,null,null,"#6 | 06 Apr 10:15 - 07 Apr 00:15"]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAABTCAYAAAAsnA/DAAAC/0lEQVR4nO1avW4TQRD+LtjKCXHCUASUICUCIYQbJBAFDRUVFeIBeAMewBK9JSoqXiE8AT01UIafNERIEVCgBB+FRRyOaqXDub3bvZ3Z2c3dJ0WRk/POfPvN7MyOnWTptEDkyOeTxOb5FS5HQsZA2gEX2Cqs0Emle9IxoW1oAxGTdkFPuivoSXcFnSQdXUfmUqoUolKagjAQGWkqBB/eVOqWEYTS944u4+biwom/cxAGAiHtG+Lh/QybOD4DfPmT4uPgAACfwgqipF+M1jAef8BwuMDu5y28+s5PGBAmvbX5A9fvfsLZS7+QXZwh337JThgQJn1+NMPo9h5+P/qJazt7wLYfu6IH2bf9NRy8u4rs7SqK1N9QllzpupxcHje/2VnH4ewBbu1uYGP8Fe8fPi7uvH7OHuKJzdxbEWp6j+lhlKXT4v7ROq4cr+LGuQWGg794evgkDNKcJ2qVfdGS5aN8SEB7kJ1WwkBH29BK0tIqc3+oKK500wZn6bRQP1Q2tae3b7WX/eC0L660BILJaRObVCEufp8uQ0dcke0Hgw6IgjR1ukVBGjhJ3CW/RXLa1OF8Pkl0+Vx+naXTwiYaxJU2vX/rNqpM2HQzK5sTrpJVtlWnomvD1KQ8OWmb9ZpKke1apn6TtaFU0xTbtdusWzs5sQmnuv9TpUudQDYNDPvpzUm4am2T52pJ25YCTlCkh1qj1WCwzQTVFToB2jQpRuEt/fVoZb/txaNcx/P5JLGae9uCMjWWa7zJs7rnoiFNiZVQHePEf0075cIhb6ZR+2fb0JtAclOsDZ8G4iz9sCmkSLe+T4ecs01wGiLESpzUaduQjy6nTUF9F27rQ9mW+IyMGssf+FX9ZiftM4Tr+nP1Op9PEhGHdI5RravW1tmMlrRLnyCa01L3dG+kQ6rp3h0xHTlzXnqC/kKN7jByRTAhB+hLDjXxYJoTn4daUEo3gWpjglHaJ3rSXUFPuivoSXcFwddpjqalVzo0cLWmnVSahDSHIpwXEDKlpb+iYYN/vRial2YyviwAAAAASUVORK5CYII=",[[40,-99.99999999999999],[0,-68]],0.8,null,null,"#7 | 07 Apr 04:45 - 14 Apr 00:45"]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAABTCAYAAAAsnA/DAAADTElEQVR4nO1av2sUURD+9rzLbeGp8RKFmIiSRixCwFiIjaXYBPQvsLBKbXGVWKWzs7fQv0AMNv4BIoKFlYiKF7C4E5SLYbOetxa6sJ77dt+veW82ex+EcLA3M9/7Zt6bN7dBJ9xOwBRzSQNxMCl9bhT1AhW7De2IiDE/aaOV0ITXJLFqiOvxCo4kwMvWAD8wFj6nqnAKtkpTgpXSG+NTuDEX4lg3xqtBiGEjIvHDSulbR1u4tPYJCyf30EZx5uqmNsCI9LV4CRcv9LG8uotu9xvK92x9eEvvOwfn0WkA0QSYb0+wvt7Hu/dnsPnmrw7hRzLfzknfb65g4cQ+toZ/SD3biLG4NMDuh2Xc3fviJAY26e0SzknfG/exNfyKh4tdfH/6GGsvHuHXuImbb901hl5q+slqiKubz7H/+iwOdo7jys5pp/69kI5/tnDuwWWt75ocVSm81PTtzyOt79kgDNR0I2PVhubBlrpZsFaagjDAnDQVWKY3lcIp2ClNTRhgRtoFYYAZaVeoJenA9gi4KEVlfLlIcSXSaUBl35ENPM8OG9KUgfggXnhOu9pNXUO4kR1WwkBNd+9c0r5Vpv5R0bvSZQvcCbeT9M+WT+Hu7Vrt6Tgo/XtX2gfY1LSMT1spzuo+LSKekp0NBg1QCdK2y60SpIH/iZvUt5ealg14FPUCUT1nP3fC7UQlG7wrLXv/Fi1UlrDsYuY2J1RHVtZXkYqmDVOZ8tZJq9grO4pUbcnGba0NtTVNUbWtY7dwcmIy9jENTMVPUankgXz3piScZ1vmuULSqkcBJWyUR2pDazCoM0E1hUgAnSZFKr19vx6d+te9eGTP8VHUC6wP+/Oc2cD0GS/zrOi5ypC2iQbXwCjxT9Nu0zDnxZRq/1Qbehn4XBRlx4eBOEk/LAtfpLXv05xrtgxGQ4SqErcatGrKV66mZWH7LqwbQ9aX9xmZbUz/4Jf3n5y0yxQu6s/Tz6OoF3gJSBSYLbupbZHPypI26RO81rSve7oz0pzOdOeByI6cKS89rF+oEW1GpmCTcoD4yLFNnE1z4nJTY6V0GWwtDBulXWJGui6Yka4LZqTrAvbnNEXTMlOaG6ha01oqbYU0hSKUFxBrSvt+RUMFvwFxrLi0eqMgRAAAAABJRU5ErkJggg==",[[40,-99.99999999999999],[0,-68]],0.8,null,null,"#8 | 14 Apr 10:45 - 15 Apr 01:15"]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAABTCAYAAAAsnA/DAAAC7ElEQVR4nO1asWobQRB9J8v4GuUDUkSocKPKRSBlIF+Qwo0hjZ0vSCkXKaPSnxBCmhQp0qQKhBSpUwaTJrYbFwGDEYGzEFGqhbN8e7d7O7Mz67sHxghOO/P2zezMji4b5fM1EseimGU+zw+4HNGMobQDIfBV2KCTSqsifVhM8PxmzG5HBemXxQSfHy/xZHyNTzvnTt9pG9qAcE6/HjzCdPcSTw/eYfXqFO933gD5FbtdMdIvign2j77g32oLf349xNfxPj7kZ1Fsi5H+MbzG8dtn2MuBv8stnGz/jmZbRU7HhpjSP4dXmK4e4NvyBt+3L6LaFj3IPkbK4U0k15GFlCqDpHKagjCQGGkqqA9vKnXLUK00B2FAOWkuqAxvLoUN1CnNTRhQRjoGYUAZ6VjoJOmMegRcF6IutmKEuBdp41DTd1wdr1pHDWlORySI19bpWKdpbFgPsvtKGOjo6V1JWlpl7h8VxZVu2uBRPl+bPyqb1tM7ttqbfnDaF1daAmpy2sUmVYiruk/biBuy/WAwAEmQpk63JEgDd4mH5LdITrs6vChmmS2fy59H+XztEw3iSrvev20bVSbsupmVzQlXySrbqlMxtGFqUp6ctM96TaXIdy1Xv8naUKppiu/abdatnZyEjH1CHfOxU5cqVWA/vTkJV63t8lwtad9SwAmK9DBrtBoMtpmghsImQJsmxSm8pV+PNvbbXjzKdXxRzDLyYX+VMQps1niXZ23PJUOaEgOtjnHiVtNOubDmzXRq/3wbehdIboq34ftAnKUfdoUU6db3ac0524SgIUKqxEmd9g355HLaFdR34bY+lG2Jz8iosfmDX9V/dtIxQ7iuPzefF8UsE3HI5hjVumZtm81kSYf0CaI5LXVPj0ZaU02P7ojryJnz0qP6hRrbYRQKNSEH2EsONXE1zUnMQ02V0k2g2hg1SsdET7or6El3BT3prkB9neZoWnqltYGrNe2k0iSkORThvICQKS39ioYP/gPjVZp+nNDnXAAAAABJRU5ErkJggg==",[[40,-99.99999999999999],[0,-68]],0.8,null,null,"#9 | 15 Apr 05:15 - 11 Jun 22:45"]},{"method":"addCircleMarkers","args":[37.286812,-82.30497200000001,10,null,null,{"interactive":true,"className":"","stroke":true,"color":"white","weight":2,"opacity":0.5,"fill":true,"fillColor":"red","fillOpacity":1},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[-82.30497200000001,-80.75,-80.75,-84.25,-82.25,-82.75,-82.25,-82.75,-81.75],"lat":[37.286812,32.25,27.25,22.75,22.75,28.25,30.75,35.75,37.25]}]]],null,[1,1,1,1,1,1,1,1,1],{"interactive":true,"className":"","stroke":true,"color":"black","weight":5,"opacity":0.7,"fill":false,"fillColor":"black","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[[37.286812,32.25,27.25,22.75,22.75,28.25,30.75,35.75,37.25],[-82.30497200000001,-80.75,-80.75,-84.25,-82.25,-82.75,-82.25,-82.75,-81.75],[18.21375476728228,5.097132734541368,5.14735685560886,5.378750066974563,22.29624904030032,5.243610795028083,9.700841347437279,5.289814473047844,16.53865060807308],null,[1,1,1,1,1,1,1,1,1],{"interactive":true,"className":"","stroke":true,"color":"white","weight":2,"opacity":1,"fill":true,"fillColor":"grey","fillOpacity":0.8},null,null,null,null,["#1, 84.9 days","#2, 0.5 days","#3, 0.5 days","#4, 0.6 days","#5, 190.7 days","#6, 0.6 days","#7, 6.8 days","#8, 0.6 days","#9, 57.7 days"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[37.286812,-82.30497200000001,18.21375476728228,null,"#1 | 01 Jul 02:15 - 24 Sep 00:15",{"interactive":true,"className":"","stroke":true,"color":"white","weight":2,"opacity":1,"fill":true,"fillColor":"black","fillOpacity":1},null,null,null,null,"#1, 84.9 days",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[32.25,-80.75,5.097132734541368,null,"#2 | 24 Sep 11:15 - 24 Sep 23:45",{"interactive":true,"className":"","stroke":true,"color":"white","weight":2,"opacity":1,"fill":true,"fillColor":"black","fillOpacity":1},null,null,null,null,"#2, 0.5 days",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[27.25,-80.75,5.14735685560886,null,"#3 | 25 Sep 10:45 - 25 Sep 23:45",{"interactive":true,"className":"","stroke":true,"color":"white","weight":2,"opacity":1,"fill":true,"fillColor":"black","fillOpacity":1},null,null,null,null,"#3, 0.5 days",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[22.75,-84.25,5.378750066974563,null,"#4 | 26 Sep 12:45 - 27 Sep 04:15",{"interactive":true,"className":"","stroke":true,"color":"white","weight":2,"opacity":1,"fill":true,"fillColor":"black","fillOpacity":1},null,null,null,null,"#4, 0.6 days",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[22.75,-82.25,22.29624904030032,null,"#5 | 27 Sep 08:15 - 06 Apr 00:45",{"interactive":true,"className":"","stroke":true,"color":"white","weight":2,"opacity":1,"fill":true,"fillColor":"black","fillOpacity":1},null,null,null,null,"#5, 190.7 days",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[28.25,-82.75,5.243610795028083,null,"#6 | 06 Apr 10:15 - 07 Apr 00:15",{"interactive":true,"className":"","stroke":true,"color":"white","weight":2,"opacity":1,"fill":true,"fillColor":"black","fillOpacity":1},null,null,null,null,"#6, 0.6 days",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[30.75,-82.25,9.700841347437279,null,"#7 | 07 Apr 04:45 - 14 Apr 00:45",{"interactive":true,"className":"","stroke":true,"color":"white","weight":2,"opacity":1,"fill":true,"fillColor":"black","fillOpacity":1},null,null,null,null,"#7, 6.8 days",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[35.75,-82.75,5.289814473047844,null,"#8 | 14 Apr 10:45 - 15 Apr 01:15",{"interactive":true,"className":"","stroke":true,"color":"white","weight":2,"opacity":1,"fill":true,"fillColor":"black","fillOpacity":1},null,null,null,null,"#8, 0.6 days",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[37.25,-81.75,16.53865060807308,null,"#9 | 15 Apr 05:15 - 11 Jun 22:45",{"interactive":true,"className":"","stroke":true,"color":"white","weight":2,"opacity":1,"fill":true,"fillColor":"black","fillOpacity":1},null,null,null,null,"#9, 57.7 days",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["#1 | 01 Jul 02:15 - 24 Sep 00:15","#2 | 24 Sep 11:15 - 24 Sep 23:45","#3 | 25 Sep 10:45 - 25 Sep 23:45","#4 | 26 Sep 12:45 - 27 Sep 04:15","#5 | 27 Sep 08:15 - 06 Apr 00:45","#6 | 06 Apr 10:15 - 07 Apr 00:15","#7 | 07 Apr 04:45 - 14 Apr 00:45","#8 | 14 Apr 10:45 - 15 Apr 01:15","#9 | 15 Apr 05:15 - 11 Jun 22:45"],[],{"collapsed":false,"autoZIndex":true,"position":"topright"}]}],"limits":{"lat":[0,40],"lng":[-99.99999999999999,-68]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="product-3-simulated-paths" class="section level3" number="3.4.3">
<h3>
<span class="header-section-number">3.4.3</span> Product 3: Simulated paths<a class="anchor" aria-label="anchor" href="#product-3-simulated-paths"><i class="fas fa-link"></i></a>
</h3>
<p>When you want to perform a post-hoc computation on the trajectory (e.g., mean flight distance), it is convenient to simulate multiple paths, compute the metric on each of them (e.g., flight distance) and compute the summary statistics afterwards (e.g., mean), instead of building this process within the HMM model which would require calculating the marginal of the pair-wise marginal distribution, typically very computationally expensive.</p>
<p>As the simulated trajectories are independent and sampled without error, you usually don’t need too many.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_simulation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://raphaelnussbaumer.com/GeoPressureR/reference/graph_simulation.html">graph_simulation</a></span><span class="op">(</span><span class="va">graph</span>,</span>
<span>  nj <span class="op">=</span> <span class="fl">10</span> <span class="co"># Number of simulation</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://raphaelnussbaumer.com/GeoPressureR/reference/plot_path.html">plot_path</a></span><span class="op">(</span><span class="va">path_simulation</span>, plot_leaflet <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-15-1.png" width="672"></div>
</div>
</div>
<div id="save" class="section level2" number="3.5">
<h2>
<span class="header-section-number">3.5</span> Save<a class="anchor" aria-label="anchor" href="#save"><i class="fas fa-link"></i></a>
</h2>
<p>You might want to save some of the key objects such as <code>tag</code> or <code>graph</code> in an <code>R</code> format. You can do so in the <code>"./data/interim"</code> folder.</p>
<p>Note that <code>graph</code> can be quite large if the number of stationary periods and grid resolution is high.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">tag</span>,</span>
<span>  <span class="va">graph</span>, <span class="co"># format(object.size(graph), units = "MB")</span></span>
<span>  <span class="va">path_most_likely</span>,</span>
<span>  <span class="va">path_simulation</span>,</span>
<span>  <span class="va">marginal</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"./data/interim/CB619.RData"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>When saving <code>tag</code> and <code>graph</code>, you also archive the functions parameters used, which can be retrieved with <code>tag$param</code> and <code>graph$param</code>.</p>

</div>
</div>



<script>
document.getElementsByClassName("book-toc")[0].insertAdjacentHTML("afterend",
                "<div class='text-center'><a href='https://github.com/Rafnuss/GeoPressureTemplate' target='_blank' class='btn btn-sm btn-outline-primary' role='button'>Start your own study</a></div>");
</script><div class="chapter-nav">
<div class="prev"><a href="pressure-map.html"><span class="header-section-number">2</span> Pressure map</a></div>
<div class="next"><a href="light-map.html"><span class="header-section-number">4</span> Light map</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#trajectory"><span class="header-section-number">3</span> Trajectory</a></li>
<li><a class="nav-link" href="#background-on-movement-modeling"><span class="header-section-number">3.1</span> Background on movement modeling</a></li>
<li><a class="nav-link" href="#create-the-graph"><span class="header-section-number">3.2</span> Create the graph</a></li>
<li><a class="nav-link" href="#set-movement-model"><span class="header-section-number">3.3</span> Set movement model</a></li>
<li>
<a class="nav-link" href="#products"><span class="header-section-number">3.4</span> Products</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#product-1-most-likely-path"><span class="header-section-number">3.4.1</span> Product 1: Most likely path</a></li>
<li><a class="nav-link" href="#product-2-marginal-probability-map"><span class="header-section-number">3.4.2</span> Product 2: Marginal probability map</a></li>
<li><a class="nav-link" href="#product-3-simulated-paths"><span class="header-section-number">3.4.3</span> Product 3: Simulated paths</a></li>
</ul>
</li>
<li><a class="nav-link" href="#save"><span class="header-section-number">3.5</span> Save</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/Rafnuss/GeoPressureManual//blob/main/03-trajectory.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/Rafnuss/GeoPressureManual//edit/main/03-trajectory.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A User Manual for GeoPressureR</strong>" was written by Raphaël Nussbaumer. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
