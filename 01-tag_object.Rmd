# (PART) Basic Tutorial {-} 

# Tag object

<iframe src="https://macaulaylibrary.org/asset/450511651/embed" height="336" width="320" class="cover" frameborder="0" allowfullscreen></iframe>
In this basic tutorial, we run through all the steps of GeoPressureR using only pressure data, with the simple example of a [Swainson's Warbler](https://ebird.org/species/swawar). This bird presents a short migration route, with only a few stopovers, making it fast to compute. 

## Create tag
Tag is used synonymously with geolocator or datalogger. An object is an R list with an [S3 class](https://stat.ethz.ch/R-manual/R-devel/library/base/html/class.html))
<div class="alert alert-info" role="alert">
<h4 class="alert-heading mt-2"><strong>What is a `tag` object?</strong></h4>
`tag` is an essential object in the GeoPressureR workflow, as it stores and aggregates all the information needed for geopositioning. Every step of the process builds on this tag object: starting from the raw data all the way to produce the pressure map. 
</div>

The `tag` object is created based on the raw geolocator data

```{r, message = FALSE}
tag <- tag_create("CB619", 
                  pressure_file = "*.deg",
                  light_file = NULL,
                  acceleration_file = NULL) 
```

The raw data for this tag id should be stored in `"data/raw-tag/CB619/"` following the default structure described in [GeoPressureTerplate](https://github.com/Rafnuss/GeoPressureTemplate#project-structure-file_folder). Because the data are recorded with a [Migrate Technology tag](https://www.migratetech.co.uk/), we use the file extension `pressure_file = "*.deg"`.

You can use the generic `plot()` function to visualize the tag data. 

```{r, warning = FALSE, message=FALSE}
plot(tag, type = "pressure")
```

Depending on when you equipped the bird and when your tag started recording data, you will likely need to crop your data to specific dates. As [it is bad practice to modify your raw data](http://drivendata.github.io/cookiecutter-data-science/#data-is-immutable), we recommend using the `crop_start` and `crop_end` arguments in `tag_create()`.


## Label tag into stationary periods

Labeling tracks involves the following two aspects: 

1. Indicate the migratory flight periods which **define STAtionary Periods** (called `stap` in the code), during which the bird is assumed to remain at the same location (+/- tens of kilometers) and same elevation level (+/- few meters)
2. **Discard pressure measurements** which should not be used to estimate position (due to, for example, sensor error, flight, minor/short change in elevation level, etc.) 

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading mt-2"><strong>Important Note</strong></h4>
Correctly labeling the track is the key step for accurate position estimation. This step requires time and effort. 

We strongly suggest that you read attentively the recommendations for this step provided in <strong>[labelling-tracks]</strong>, after following the basic and advanced tutorials (as labelling relies on functions and tools presented later in the tutorial).
</div>


### Initialize and create the label .csv file

Use `tag_label_write()` to initiate the label (i.e., empty label column) and create the label file to `"data/tag-label/CB619.csv"`.

```{r, message=FALSE}
tag_label_write(tag)
```


### Label manually on Trainset

Open [https://trainset.raphaelnussbaumer.com/](https://trainset.raphaelnussbaumer.com/) and click on "Upload Tag Label" to load your .csv file. Instructions on how to label the file can be found in the dedicated chapter [labelling tracks]. Once you have finished, export the new `csv` file in the same folder `/data/tag-label/CB619-labeled.csv` (TRAINSET will automatically add `-labeled` in the name).

![*Print screen of the manual classification in TRAINSET. See [labelling-tracks] for more information.*](assets/labelling-tracks-0.png){width=100%}

### Read labelled file

Read the exported file with `tag_label_read()` to update `tag$pressure` (and, when relevant, `tag$acceleration`), with a new `label` column.

```{r, message=FALSE}
tag <- tag_label_read(tag)
kable(head(tag$pressure), format = "html")
```

### Compute stationary period

`tag_label_stap()` then creates the stationary periods based on these labels:

```{r, message=FALSE}
tag <- tag_label_stap(tag)
kable(head(tag$stap), format = "html")
```

Plotting the pressure timeserie of tag provides additional information:

```{r, warning = FALSE, message=FALSE}
plot(tag, type = "pressure")
```

<div class="alert alert-info" role="alert">
<h4 class="alert-heading mt-2"><strong>What is the pre-processing?</strong></h4>
You might notice some discrepancies between the raw data (grey) and the pre-processed pressure timeseries of each stationary period (colored line). As the pre-processed timeseries will compared to weather re-analysis data (ERA-5), it should include only pressure measurements at the same location, on the ground, and be on a 1hr resolution. The black dots show the discarded pressure points, corresponding to bird vertical movement rather than natural variation of pressure.
</div>
